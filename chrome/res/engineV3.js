var DPEngineComponents = {"probe":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");function onDocReady(callback){function isDocumentReady(){var readyState=window.document.readyState;return readyState===\"interactive\"||readyState===\"complete\"}var isCalled=false;function readyStateChangeCallback(){if(isCalled===false&&isDocumentReady()===true){isCalled=true;callback()}}if(isDocumentReady()===true){callback()}else{sandbox.bindEventListener(window,\"readystatechange\",readyStateChangeCallback)}}onDocReady(function(){sandbox.Xnote(\"probe: is top window = \"+(window==window.top));try{sandbox.probe()}catch(e){sandbox.Xcept(\"probe exception: \"+e.message)}var withFormfilling=\"_mobile_with_formfilling\";if(withFormfilling===\"_mobile_\"+\"with_formfilling\"){withFormfilling=true}else{withFormfilling=false}if(withFormfilling){try{sandbox.startFormFilling();sandbox.setStyltPath($externalcss$);sandbox.injectStyles(function(){sandbox.detect($detectkey$)})}catch(e){sandbox.Xcept(\"detect exception: \"+e.message)}}})})();","replay":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");try{sandbox.replay($passcard$)}catch(e){if(sandbox.Xcept)sandbox.Xcept(\"replay exception: \"+e.message)}})();","pattern":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");var modPatternPlatform={_name:\"pattern-platform\",_require:[\"log\"],_export:[\"patternRecord\",\"patternReplay\"],patternRecord:function(pattern){var res={};res.step=0;res.siteID=0;res.recording=false;res.location=\"\";res.faviconURL=\"\";res.domain=\"\";res.title=\"\";res.launchSW=false;res.showLaunchSW=false;return res},patternReplay:function(passcard){this._sandbox.Xcept(\"patternReplay: should not reach here, try to use ptnlessReplay anyway\");this._sandbox.ptnlessReplay(passcard,{from:\"pattern-platform-default\"})}};meta.loadModule(sandbox,modPatternPlatform)})();","pattern0":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");var modPatternPlatform={_name:\"pattern-platform\",_require:[\"callback\",\"dom\",\"utils\",\"keystroke-encryption\",\"heuristics\"],_export:[\"patternRecord\",\"patternReplay\"],patternRecord:function(){var sandbox=this._sandbox;var pattern=sandbox._pattern;pattern._sandbox=sandbox;var res={};res.step=pattern.getStep();sandbox.Xnote(\"pattern-0: patternRecord() - res.step = \"+res.step);var patternValid=res.step!=0;res.siteID=pattern.siteID;if(pattern.record){res.recording=pattern.record(res.step);sandbox.Xnote(\"pattern-0: patternRecord() - res.recording = \"+res.recording)}else{sandbox.Xcept(\"patternRecord0: record not defined in pattern\");res.recording=false}res.readyToRecord=res.recording;res.isMultiStepPattern=true;if(res.recording==false){sandbox.Xnote(\"[modPatternPlatform-0][patternRecord] recording=false, call getLoginFormIndex() to get a chance to try patternless login ... if I can find a login form.\");if(sandbox.getLoginFormIndex()>-1){sandbox.Xnote(\"[modPatternPlatform-0][patternRecord] Login form found. Reset step=1 and recording=true.\");res.recording=true}}res.location=patternValid?pattern.getLocation?pattern.getLocation():sandbox.getLocation():\"\";res.faviconURL=patternValid?pattern.getFaviconURL?pattern.getFaviconURL():sandbox.getFaviconURL():\"\";res.domain=patternValid?pattern.getDomain?pattern.getDomain():sandbox.getDomain():\"\";res.title=patternValid?pattern.getTitle?pattern.getTitle():sandbox.getTitle():\"\";res.notReturn=patternValid?pattern.notReturn?pattern.notReturn():false:false;res.launchSW=patternValid&&pattern.launchSW;res.showLaunchSW=patternValid&&pattern.showLaunchSW;res.sbURL=patternValid?pattern.sbURL?pattern.sbURL():\"\":\"\";res.hasSignupForm=patternValid?pattern.hasSignupForm?pattern.hasSignupForm():false:false;sandbox.Xnote(\"[modPatternPlatform-0][patternRecord] record() result = \"+sandbox.stringify(res));return res},patternReplay:function(passcard){var sandbox=this._sandbox;if(passcard.siteID==null){sandbox.Xcept(\"[modPatternPlatform-0][patternReplay] siteID not found\");return}var pattern=sandbox._pattern;if(pattern==null){sandbox.Xcept(\"[modPatternPlatform-0][patternReplay] pattern not found\");return}if(pattern.replay==null){sandbox.Xcept(\"[modPatternPlatform-0][patternReplay] replay function not defined\");return}this._replay(passcard)},_replay:function(passcard){var sandbox=this._sandbox;var pattern=sandbox._pattern;var form;var forms=sandbox.getElementsByTagName(\"form\");var loginFormIndex=sandbox.getLoginFormIndex();var recordable=loginFormIndex>-1;if(loginFormIndex>-1){form=forms[loginFormIndex];sandbox.Xnote(\"pattern-platform-0: replay: get a visible login form = \"+sandbox.stringify(form))}sandbox.Xnote(\"pattern-0 _replay(): form == \"+(!!form?sandbox.stringify(form):\"no form\"));var extraInfo={};extraInfo.siteID=pattern.siteID||0;extraInfo.currentStep=pattern.getStep();extraInfo.pattern={};extraInfo.patternType=0;extraInfo.stepPattern={};extraInfo.formAction=sandbox.getFormAction(form);extraInfo.formData=sandbox.getLoginFormData(form);extraInfo.locationNoQuery=sandbox.stripQueryString(sandbox.getLocation());extraInfo.passcardLocation=passcard.location;extraInfo.passcardInfo=sandbox.getPasscardAttr(passcard);extraInfo.referrer=sandbox._window.document.referrer;extraInfo.title=pattern.title?pattern.title:sandbox.getTitle();var isReplayOK;if((extraInfo.currentStep==-1||extraInfo.currentStep==0)&&recordable){sandbox.Xcept(\"######## pattern-0: _replay(): Give me a change to try patternless login, if I can find a login form...\");isReplayOK=false}else{isReplayOK=pattern.replay(passcard)}if(isReplayOK==null){sandbox.Xnote(\"pattern-0 : _replay() : isReplayOK => null\");return}if(isReplayOK===false){sandbox.Xnote(\"pattern-platform-0: replay failed, and try to use ptnlessReplay\");sandbox.ptnlessReplay(passcard,{from:\"pattern-platform-0\",extraInfo:extraInfo})}else{sandbox.engineFeedback(65808,\"pattern-0 replay OK\",extraInfo)}}};meta.loadModule(sandbox,modPatternPlatform);$operationPattern$})();","pattern1":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");var modPatternPlatform={_name:\"pattern-platform\",_require:[\"callback\",\"dom\",\"utils\",\"keystroke-encryption\",\"heuristics\"],_export:[\"patternRecord\",\"patternReplay\"],getPatternStepLength:function(pattern){var step=pattern.step;var len=0;if(step!=null){for(var o in step){if(step.hasOwnProperty(o)==true){len++}}}if(pattern.step[-1]!=null){len--}if(pattern.step[999]!=null){len--}return len},patternRecord:function(){var sandbox=this._sandbox;var pattern=sandbox._pattern;var res={};res.step=this.getStep();var patternValid=res.step!=0;res.siteID=pattern.siteID;res.recording=patternValid?this.record(res.step):false;res.readyToRecord=res.recording;res.isMultiStepPattern=false;if(pattern.isMultiStepPattern!=null){res.isMultiStepPattern=pattern.isMultiStepPattern===true}else if(pattern.step!=null){var totalSteps=this.getPatternStepLength(pattern);res.isMultiStepPattern=totalSteps>1}if(res.recording==false){sandbox.Xnote(\"[modPatternPlatform-1][patternRecord] recording==false, try to find if any recordable attributes.\");var isRecordable=sandbox.getLoginFormIndex()>-1;if(isRecordable){sandbox.Xnote(\"[modPatternPlatform-1][patternRecord] Recordable attributes found, reset recording=true.\");res.recording=true}}res.location=patternValid?pattern.location?pattern.location:sandbox.getLocation():sandbox.getLocation();res.faviconURL=patternValid?pattern.faviconURL?pattern.faviconURL:sandbox.getFaviconURL():sandbox.getFaviconURL();res.domain=patternValid?pattern.domain?pattern.domain:sandbox.getDomain():sandbox.getDomain();res.title=patternValid?pattern.title?pattern.title:sandbox.getTitle():sandbox.getTitle();res.notReturn=patternValid?pattern.step[res.step]&&pattern.step[res.step].isNotReturn?true:pattern.notReturn?pattern.notReturn():false:false;res.launchSW=patternValid&&pattern.launchSW;res.showLaunchSW=patternValid&&pattern.showLaunchSW;res.sbURL=patternValid?pattern.sbURL?pattern.sbURL():\"\":\"\";res.hasSignupForm=patternValid&&res.step!==-1?pattern.step[res.step].signup?pattern.step[res.step].signup:false:false;sandbox.Xnote(\"[modPatternPlatform-1][patternRecord] probe result = \"+sandbox.stringify(res));return res},patternReplay:function(passcard){var sandbox=this._sandbox;var pattern=sandbox._pattern;if(passcard.siteID==null){sandbox.Xchkpt(\"[modPatternPlatform-1][patternReplay] siteID not found. Go to ptnlessReplay()\");return false}if(pattern==null){sandbox.Xchkpt(\"[modPatternPlatform-1][patternReplay] pattern not found. Go to ptnlessReplay()\");return false}var step=this.getStep();this.doReplay(step,passcard)},getStep:function(){var sandbox=this._sandbox;var pattern=sandbox._pattern;if(!pattern.step){sandbox.Xcept(\"[modPatternPlatform-1][getStep] getStep: step not defined\");return 0}for(var i in pattern.step){if(this.checkStep(pattern.step[i]))return parseInt(i)}if(pattern.finishIfStepUnknown)return-1;return 0},checkStep:function(step){var sandbox=this._sandbox;if(step.checkFunction){var mod=this;var execEnv={matchURL:function(url){return mod.checkURL(url)},checkElement:function(xpath){return sandbox.getElementsByXPath(xpath)!=null},_sandbox:sandbox};try{return step.checkFunction.apply(execEnv)}catch(e){sandbox.Xcept(\"checkStep: checkFunction error: \"+e.message);return false}}else{if(step.url){if(!this.checkURL(step.url)){return false}}if(step.urlNotMatch){if(this.checkURL(step.urlNotMatch))return false}if(step.lookFor){if(!this.checkElement(step.lookFor))return false}if(step.lookForNotExist){if(this.checkElement(step.lookForNotExist))return false}if(step.lookForAllNotExist){if(!this.checkNoElement(step.lookForAllNotExist)){sandbox.Xcept(\"checkStep: lookForAllNotExist = \"+step.lookForAllNotExist+\" fail!\");return false}}if(step.input){if(!this.checkInput(step.input,step.inputTarget))return false}return true}},checkURL:function(url){var loc=this._sandbox.getLocation().toLowerCase();return loc.indexOf(url.toLowerCase())>-1},checkElement:function(element){for(var i=0;i<element.length;++i){if(!this._sandbox.getElementsByXPath(element[i]))return false}return true},checkNoElement:function(element){for(var i=0;i<element.length;++i){if(this._sandbox.getElementsByXPath(element[i]))return false}return true},checkInput:function(input,inputTarget){for(var i=0;i<input.length;++i){if(!this.getInputElement(input[i],inputTarget))return false}return true},getInputElement:function(inputName,inputTarget){var elementFound=null;var sandbox=this._sandbox;if(inputTarget&&inputTarget[inputName]){elementFound=sandbox.getElementByXPath(inputTarget[inputName]);if(elementFound!=null)return elementFound}return sandbox.getInputElementByIdOrName(inputName)},record:function(step){var sandbox=this._sandbox;var pattern=sandbox._pattern;sandbox.Xnote(\"pattern-platform-1: record: step = \"+step);if(step==-1)return false;if(!pattern.step[step])return false;if(!pattern.account){sandbox.Xcept(\"pattern-platform-1: record: account not defined\");return false}var stepPattern=pattern.step[step];var stepSaveOnSubmit=stepPattern.saveOnSubmit==null?false:stepPattern.saveOnSubmit;if(stepPattern.waitElement){var waitElement=stepPattern.waitElement;var type=waitElement.type;sandbox.Xnote(\"start wait element\");if(!type){sandbox.Xcept(\"pattern-platform-1: record: waitElement type not set\");return false}var targetXPath=waitElement.target;if(type==\"create\"){if(waitElement.target&&waitElement.trigger){var triggerXPath=waitElement.trigger;sandbox.AwaitElementAdded(targetXPath,triggerXPath)}else{sandbox.Xcept(\"pattern-platform-1: record: waitElement target or trigger XPath not set\");return false}}else if(type==\"frameReload\"){if(waitElement.target){sandbox.AwaitElementReload(targetXPath);return true}else{return false}}else if(type==\"modify\"){if(waitElement.target){sandbox.AwaitElementChange(targetXPath)}else{sandbox.Xcept(\"pattern-platform-1: record: waitElement targetXPath not set\");return false}}else if(type==\"remove\"){if(waitElement.target){sandbox.AwaitElementRemove(targetXPath)}else{sandbox.Xcept(\"pattern-platform-1: record: waitElement targetXPath not set\");return false}}}if(stepPattern.dynamic){var dynamic=stepPattern.dynamic;if(dynamic.loginButtonXPath&&dynamic.formXPath){var loginButtonXPath=dynamic.loginButtonXPath;var formXPath=dynamic.formXPath;var loginButtons=sandbox.getElementsByXPath(loginButtonXPath);sandbox.probeAfterClick(loginButtons,function(){return sandbox.getElementByXPath(formXPath)?true:false},function(){var element=sandbox.getElementByXPath(formXPath);if(element==null){return true}else{return element.tagName===\"IFRAME\"}});return true}else{sandbox.Xcept(\"pattern-platform-1: record: need to have loginXPath and formXPath attrs in dynamic\");return false}}if(!stepPattern.input){sandbox.Xnote(\"pattern-platform-1: record: input not defined, proceed anyway\");sandbox.probeReturnHasDone=function(){var res={};res.domain=pattern.domain?pattern.domain:sandbox.getDomain();res.formAction=\"\";res.siteID=pattern.siteID;res.data=[];res.saveOnSubmit=stepSaveOnSubmit;sandbox.callback(\"storeData\",sandbox.stringify(res))};return true}var inputs=[];var input;for(var i=0;i<stepPattern.input.length;++i){inputs[i]=this.getInputElement(stepPattern.input[i],stepPattern.inputTarget);var d=sandbox.serializeInput(inputs[i],true);if(!d){sandbox.Xcept(\"pattern-platform-1: record: unable to serialize input\");return false}if(d.type==\"password\"){if(stepPattern.noencrypt&&sandbox.inArray(d.name,stepPattern.noencrypt))continue;sandbox.bindEncryptionEvents(inputs[i])}sandbox.Xnote(\"[BEGIN] 2017-11: TMPM-2452 on stepPattern.input[i]: \"+stepPattern.input[i]);input=inputs[i];var val=input.value;if(val==null||val==\"\"){sandbox.setInputDataProvidedStatus(input,\"no\")}else{sandbox.setInputDataProvidedStatus(input,\"yes\")}sandbox.bindEventListener(input,\"paste\",function(e){if(sandbox.validInputData(e.target,false)){sandbox.setInputDataProvidedStatus(e.target,\"yes\")}else{sandbox.setInputDataProvidedStatus(e.target,\"no\")}});sandbox.bindEventListener(input,\"input\",function(e){if(sandbox.validInputData(e.target,false)){sandbox.setInputDataProvidedStatus(e.target,\"yes\")}else{sandbox.setInputDataProvidedStatus(e.target,\"no\")}});sandbox.Xnote(\"[END] 2017-11: TMPM-2452 on stepPattern.input[i]: \"+stepPattern.input[i])}var mod=this;var submitEventHandler=function(e){if(e.type===\"keypress\"||e.type===\"keydown\"){if(e.keyCode!==13&&e.charCode!==13){return}}sandbox.Xnote(\"pattern-platform-1: record: submit event captured\");storeFormData()};var storeFormData=function(){var data=[],dataForFeedback=[];for(var i=0;i<inputs.length;++i){sandbox.Xnote(\"pattern-platform-1: serializing input: \"+inputs[i].name);var d=sandbox.serializeInput(inputs[i],true);if(!d){sandbox.Xcept(\"pattern-platform-1: record: unable to serialize input\");return}d.name=stepPattern.input[i];if(d.name==pattern.account)d.account=true;if(pattern.alias){var alias=mod.getAliases(d.name,pattern.alias);if(alias){d.name=alias[0];if(sandbox.inArray(pattern.account,alias))d.account=true}}dataForFeedback.push(d);if(!d.value){sandbox.Xnote(\"pattern-platform-1: record: unable to get element value, skip\");continue}data.push(d)}var dataResult=sandbox.isDataProvided(dataForFeedback);var res={};res.domain=pattern.domain?pattern.domain:sandbox.getDomain();res.formAction=\"\";res.siteID=pattern.siteID;res.data=data;res.saveOnSubmit=stepSaveOnSubmit;res.dataReadyFlag=dataResult.dataProvided;res.hasValue=dataResult.hasValue;if(stepPattern.signup){res=sandbox.mapSignupStoreData(res)}sandbox.callback(\"storeData\",sandbox.stringify(res))};var bindSubmitEventHandler=function(bind,submitEventHandler){var xpath=bind.target;var eventType=bind.type;if(!xpath||!eventType){sandbox.Xcept(\"pattern-platform-1: record: bind event data incomplete\")}else{var element=sandbox.getElementByXPath(xpath);if(!element){sandbox.Xcept(\"pattern-platform-1: record: unable to get bind event element\")}else{sandbox.Xnote(\"pattern-platform-1: record: binding submitEventHandler\");if(bind.type===\"click\"){var submitEventHandlerOrg=submitEventHandler;submitEventHandler=function(){sandbox._isDataStored=false;submitEventHandlerOrg.apply(null,arguments)}}sandbox.bindEventListener(element,eventType,submitEventHandler);if(bind.type==\"submit\"){sandbox.Xnote(\"pattern-platform-1: record: hookFormSubmit\");sandbox.hookFormSubmit(element,storeFormData)}}}};if(stepPattern.bind){sandbox.Xnote(\"pattern-platform-1: record: stepPattern.bind\");var bind=stepPattern.bind;bindSubmitEventHandler(bind,submitEventHandler)}else if(stepPattern.binds){sandbox.Xnote(\"pattern-platform-1: record: stepPattern.binds\");var binds=stepPattern.binds;for(var i=0;i<binds.length;i++){bindSubmitEventHandler(binds[i],submitEventHandler)}}var form;var bindSubmit=stepPattern.bindSubmit!=null?stepPattern.bindSubmit:true;for(var i=0;i<inputs.length;i++){if(inputs[i].form){form=inputs[i].form;break}}if(form&&bindSubmit){sandbox.bindEventListener(form,\"submit\",submitEventHandler);sandbox.hookFormSubmit(form,storeFormData)}return true},copyDataToInputElements:function(passcardData,patternAlias,stepPattern){var sandbox=this._sandbox;var inputTarget=stepPattern!=null?stepPattern.inputTarget:null;sandbox.Xnote(\"Enter [modPatternPlatform-1][copyDataToInputElements]\");var copyCount=0;for(var i=0;i<passcardData.length;i++){sandbox.Xnote(\"[modPatternPlatform-1][copyDataToInputElements] passcardData[\"+i+\"] =\"+\" type: \"+passcardData[i].type+\", name: \"+passcardData[i].name+(passcardData[i].account==true?\" (account)\":\"\"));if(passcardData[i].type==\"deleted\")continue;var targetElement=this.locateValidInput(passcardData[i].name,patternAlias,inputTarget);if(targetElement!=null){if(stepPattern!=null&&stepPattern.input!=null){for(var k=0;k<stepPattern.input.length;k++){var stepInput=this.getInputElement(stepPattern.input[k],inputTarget);if(stepInput==targetElement){sandbox.setValueWithKeyEvent(targetElement,passcardData[i].value);copyCount++;break}}}}}return copyCount},locateValidInput:function(orgInputName,patternAlias,inputTarget){var sandbox=this._sandbox;var alias=[];if(patternAlias){alias=this.getAliases(orgInputName,patternAlias)}if(!alias||alias.length==0){alias=[orgInputName]}var inputName;var inputElm;for(var j=0;j<alias.length;++j){inputName=alias[j];inputElm=this.getInputElement(inputName,inputTarget);if(inputElm!=null)break}if(!inputElm){sandbox.Xchkpt(\"[modPatternPlatform-1][locateValidInputByName] Cannot find valid input: \"+orgInputName)}return inputElm},fillStepInputs:function(step,passcard){var sandbox=this._sandbox;var pattern=sandbox._pattern;var stepPattern=pattern.step[step];sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] On pattern step = \"+step);if(step===-1||step===0){sandbox.Xchkpt(\"[modPatternPlatform-1][fillStepInput] Got a chance to dual-mode...\");var loginFormIndex=sandbox.getLoginFormIndex();var recordable=loginFormIndex>-1;return!recordable}if(stepPattern!=null&&stepPattern.isNotReturn){return true}if(!pattern.step[step]){if(step==-1&&pattern.finishIfStepUnknown){sandbox.Xnote(\"FINAL_STEP, just return w/o feedback\");return}sandbox.Xcept(\"pattern.step[step]==null, jump to patternless replay (DUAL MODE)\");return false}if(step==-1){sandbox.Xnote(\"FINAL_STEP, just return w/o feedback\");return}if(stepPattern.signup===true){sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] don't replay on signup step = \"+step);return}var stepSaveOnSubmit=stepPattern.saveOnSubmit==null?false:stepPattern.saveOnSubmit;var res={};res.domain=pattern.domain?pattern.domain:sandbox.getDomain();res.formAction=\"\";res.siteID=pattern.siteID;res.data=null;res.saveOnSubmit=stepSaveOnSubmit;if(stepPattern.waitElement){sandbox.callback(\"replayNext\",sandbox.stringify(res));var waitElement=stepPattern.waitElement;var type=waitElement.type;if(!type){sandbox.Xcept(\"[modPatternPlatform-1][fillStepInputs] No waitElement.type, cannot go forward. Jump to patternless replay (DUAL MODE)\");return false}if(type==\"create\"){if(waitElement.target!=null&&waitElement.trigger!=null){var triggerXPath=waitElement.trigger;var button=sandbox.getElementsByXPath(triggerXPath)[0];sandbox.triggerEvent(button,\"click\");sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] waitElement, trigger Button\");return true}else{sandbox.Xcept(\"[modPatternPlatform-1][fillStepInputs] waitElement target||trigger does not exist\")}return false}}if(stepPattern.dynamic){var dynamic=stepPattern.dynamic;if(dynamic.loginButtonXPath!=null&&dynamic.formXPath!=null){var loginButtonXPath=dynamic.loginButtonXPath;var formXPath=dynamic.formXPath;var _this=this;sandbox.replayAfterAction(function(){sandbox.callback(\"replayNext\",sandbox.stringify(res));var loginButton=sandbox.getElementsByXPath(loginButtonXPath)[0];sandbox.triggerEvent(loginButton,\"click\")},function(){return sandbox.getElementByXPath(formXPath)?true:false},function(){_this.patternReplay(passcard)})}else{sandbox.Xcept(\"[modPatternPlatform-1][fillStepInputs] Need loginXPath and formXPath attrs in dynamic\")}}var filledCount=this.copyDataToInputElements(passcard.data,pattern.alias,stepPattern);if(stepPattern.input!=null&&stepPattern.input.length!=null&&stepPattern.input.length!=filledCount){sandbox.Xchkpt(\"[modPatternPlatform-1][fillStepInputs] Not all stepPattern.inputs are filled (may be caused by incorrect passcard.data[].name).\");sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] Replace passcard.data[].name with stepPattern.input[].name; and copy data again.\");var replacedInputName=[];var passData;var i,j;var accountElm=this.locateValidInput(pattern.account,pattern.alias,stepPattern.inputTarget);if(accountElm!=null){pattern.account=accountElm.name||accountElm.id}for(i=0;i<passcard.data.length;i++){passData=passcard.data[i];if(passData.type==\"deleted\")continue;if(passData.account==true||passData.name==\"USERNAME\"&&passData.type==\"text\"){sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] Replace passcard account '\"+passData.name+\"' with '\"+pattern.account+\"'\");passData.name=pattern.account;replacedInputName.push(passData.name);continue}for(j=0;j<stepPattern.input.length;j++){var stepInputName=stepPattern.input[j];var inputElm=this.locateValidInput(stepInputName,pattern.alias,stepPattern.inputTarget);if(inputElm!=null){stepInputName=inputElm.name||inputElm.id}else{sandbox.Xchkpt(\"[modPatternPlatform-1][fillStepInputs] Find next input.\");continue}if(stepInputName==pattern.account){continue}if(replacedInputName.indexOf(stepInputName)==-1){var isPasswordInput=inputElm.type!=null&&inputElm.type.toLowerCase()==\"password\";if(isPasswordInput&&passData.type==\"password\"||!isPasswordInput&&passData.type!=\"password\"){sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] Replace passcard field '\"+passData.name+\"' with '\"+stepInputName+\"'\");passData.name=stepInputName;replacedInputName.push(passData.name);break}}}}filledCount=this.copyDataToInputElements(passcard.data,pattern.alias,stepPattern)}var fillinOK=null;if(stepPattern.input&&stepPattern.input.length){fillinOK=stepPattern.input.length===filledCount}sandbox.Xnote(\"[modPatternPlatform-1][fillStepInputs] form-filling result = \"+(fillinOK||\"no form-filling\"));return fillinOK},getFormByParameters:function(passcardData,patternAlias,stepPattern){var sandbox=this._sandbox;sandbox.Xnote(\"[modPatternPlatform-1][getFormByParameters] Enter \");var form=null;for(var i=0;i<passcardData.length;++i){if(passcardData[i].type==\"deleted\"){continue}var inputElm=this.locateValidInput(passcardData[i].name,patternAlias,stepPattern!=null?stepPattern.inputTarget:null);if(inputElm!=null){if(!form){sandbox.Xnote(\"[getFormByParameters] Assign a form for submission\");form=inputElm.form}if(form!=null){sandbox.Xnote(\"[getFormByParameters] The login form was FOUND by pattern definition.\");break}if(!form){sandbox.Xnote(\"[getFormByParameters] To find ptnless login form ...\");var forms=sandbox.getElementsByTagName(\"form\");var index=sandbox.getLoginFormIndex(forms);if(index>-1){form=forms[index];sandbox.Xnote(\"[getFormByParameters] Found a login form, index = \"+index)}else{sandbox.Xnote(\"[getFormByParameters] Really no login form!\")}}if(form!=null){break}}}sandbox.Xnote(\"[modPatternPlatform-1][getFormByParameters] Leave\");return form},doReplay:function(step,passcard){var sandbox=this._sandbox;var pattern=sandbox._pattern;var stepPattern=pattern.step[step];var isReplayOK=this.fillStepInputs(step,passcard);if(isReplayOK===null){sandbox.Xnote(\"[modPatternPlatform-1][doReplay] : isReplayOK => null\");return}sandbox.Xnote(\"[modPatternPlatform-1][doReplay] : isReplayOK => \"+isReplayOK);var form=null;if(isReplayOK===true){form=this.getFormByParameters(passcard.data,pattern.alias,stepPattern);var isDangerousForm=sandbox.isDangerousForm(form);sandbox.engineFeedback(65809,\"pattern-1 replay OK\",{siteID:pattern.siteID||0,currentStep:step,stepPattern:stepPattern,patternType:1,referrer:sandbox._window.document.referrer,passcardLocation:passcard.location,passcardInfo:sandbox.getPasscardAttr(passcard),locationNoQuery:sandbox.stripQueryString(sandbox.getLocation()),replayOnDangerousForm:isDangerousForm});var patternSubmit=true;if(stepPattern!=null){patternSubmit=stepPattern.nosubmit!==null&&stepPattern.nosubmit!==undefined?!stepPattern.nosubmit:true}sandbox.Xnote(\"patternSubmit = \"+patternSubmit+\", passcard.submit = \"+passcard.submit);if(stepPattern!=null&&passcard.submit===true&&patternSubmit===true){sandbox.Xnote(\"[modPatternPlatform-1][doReplay] To go next step (submitting...)\");if(stepPattern.trigger){sandbox.Xnote(\"pattern-platform-1: stepPattern.trigger is \"+sandbox.stringify(stepPattern.trigger));var target=stepPattern.trigger.target;var type=stepPattern.trigger.type;if(target===null||type===null){sandbox.Xcept(\"[modPatternPlatform-1][doReplay] unable to trigger event. invalid parameter.\");if(stepPattern.isNotReturn===false&&isDangerousForm===false){sandbox.submitForm(form)}return}var element=sandbox.getElementByXPath(target);if(element==null){sandbox.Xcept(\"[modPatternPlatform-1][doReplay] unable to trigger event. element not found.\");if(stepPattern.isNotReturn===false&&isDangerousForm===false){sandbox.submitForm(form)}return}sandbox.triggerEvent(element,type)}else{sandbox.Xnote(\"[modPatternPlatform-1][doReplay] stepPattern.trigger is null or false, submit(form) directly.\");if(form!=null){sandbox.Xnote(\"[modPatternPlatform-1][doReplay] sandbox.submitForm(form)\");if(stepPattern==null||stepPattern.isNotReturn===false){if(isDangerousForm===false){sandbox.submitForm(form)}}}}}}else{sandbox.Xnote(\"[modPatternPlatform-1][doReplay] Filled input number not matched, fallback to ptnlessReplay\");form=null;var forms=sandbox.getElementsByTagName(\"form\");var loginFormIndex=sandbox.getLoginFormIndex(forms);if(loginFormIndex>-1){form=forms[loginFormIndex]}var extraInfo={};extraInfo.siteID=pattern.siteID||0;extraInfo.currentStep=step;extraInfo.stepPattern=stepPattern;extraInfo.pattern=pattern;extraInfo.patternType=1;extraInfo.formAction=sandbox.getFormAction(form);extraInfo.formData=sandbox.getLoginFormData(form);extraInfo.locationNoQuery=sandbox.stripQueryString(sandbox.getLocation());extraInfo.passcardLocation=passcard.location;extraInfo.passcardInfo=sandbox.getPasscardAttr(passcard);extraInfo.referrer=sandbox._window.document.referrer;extraInfo.title=pattern.title?pattern.title:sandbox.getTitle();sandbox.Xchkpt(\"[pattern-platform-1][doReplay] isReplayOk===false, fallback to ptnlessReplay()\");sandbox.ptnlessReplay(passcard,{from:\"pattern-platform-1\",extraInfo:extraInfo})}},getAliases:function(name,aliasSet){var sandbox=this._sandbox;if(!sandbox.isArray(aliasSet))return null;for(var i=0;i<aliasSet.length;++i){if(sandbox.inArray(name,aliasSet[i]))return aliasSet[i]}return null}};meta.loadModule(sandbox,modPatternPlatform);$operationPattern$})();","modules":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");var modConfig={_name:\"config\",_require:[],_exportAll:true,signupPattern:$signupPattern$,WAIT_TICK:100,MAX_POOLING:5e3};meta.loadModule(sandbox,modConfig);var l10n=$l10n$;var modBrowser={_name:\"browser\",_require:[],_export:[\"getEnv\",\"isSanity\"],getEnv:function(){if(this.env===undefined){var platform=\"windows\";if(platform==\"windows\"){if(navigator&&navigator.userAgent){if(navigator.userAgent.indexOf(\"MSIE\")!=-1||navigator.userAgent.indexOf(\"Trident\")!=-1)this.env=\"windows/ie\";else if(navigator.userAgent.indexOf(\"Firefox\")!=-1)this.env=\"windows/firefox\";else if(navigator.userAgent.indexOf(\"Chrome\")!=-1)this.env=\"windows/chrome\";else if(navigator.userAgent.indexOf(\"Safari\")!=-1)this.env=\"windows/safari\";else this.env=\"windows/unknown\"}else{this.env=\"windows/unknown\"}}else if(platform==\"mac\"){if(navigator&&navigator.userAgent){if(navigator.userAgent.indexOf(\"Safari\")!=-1)this.env=\"mac/safari\";else if(navigator.userAgent.indexOf(\"Chrome\")!=-1)this.env=\"mac/chrome\";else if(navigator.userAgent.indexOf(\"Firefox\")!=-1)this.env=\"mac/firefox\"}else this.env=\"mac/unknown\"}else{this.env=platform}meta.log(\"env = \"+this.env)}return this.env},isSanity:function(){return true;var sandbox=this._sandbox;var doc=sandbox._window.document;if(!this.isNativeFunction(\"getElementsByTagName\",doc))return false;return true},isNativeFunction:function(funcName,obj){if(!obj||!obj[funcName])return true;var funcString=obj[funcName]+\"\";var re=new RegExp(\"^\\\\s*function\\\\s+\"+funcName+\"\\\\s*\\\\(\\\\s*\\\\)\\\\s*{\\\\s*\\\\[native code\\\\]\\\\s*}\\\\s*$\",\"ig\");return re.test(funcString)}};meta.loadModule(sandbox,modBrowser);var modCallback={_name:\"callback\",_require:[\"browser\"],_export:[\"callback\",\"engineFeedback\"],engineFeedback:function(resultID,reason,extra){var extraInfo=extra||{};delete extraInfo.pattern;delete extraInfo.referrer;delete extraInfo.title;var feedback={resultID:resultID,reason:\"[ENGINE] \"+reason,extraInfo:extraInfo};meta.log(\"engineFeedback = \"+sandbox.stringify(feedback));sandbox.callback(\"engineFeedback\",sandbox.stringify(feedback))},callback:function(cmd,arg,onReturn){console.log(\"[Engine]: CALLBACK: cmd=\"+cmd);if(cmd===\"storeData\"||cmd===\"replayNext\"){if(sandbox._isDataStored===false){var modArg=null;try{modArg=JSON.parse(arg)}catch(e){}if(modArg!=null){modArg.probeResult=sandbox._probeResult;arg=JSON.stringify(modArg)}sandbox._callback({cmd:cmd,arg:arg});sandbox._isDataStored=true}}else{sandbox._callback({cmd:cmd,arg:arg})}console.log(\"[Engine]: fire customEvent --> done\")}};meta.loadModule(sandbox,modCallback);var modLog={_name:\"log\",_require:[\"callback\"],_export:[\"Xchkpt\",\"Xnote\",\"Xcept\"],Xchkpt:function(msg){if(DP_VERSION<\"3.0\"){this._sandbox.callback(\"Xchkpt\",msg)}console.log(\"Xchkpt: \"+msg)},Xnote:function(msg){if(DP_VERSION<\"3.0\"){this._sandbox.callback(\"Xnote\",msg)}console.info(\"Xnote: \"+msg)},Xcept:function(msg){if(DP_VERSION<\"3.0\"){this._sandbox.callback(\"Xcept\",msg)}console.error(\"Xcept: \"+msg)}};meta.loadModule(sandbox,modLog);var modFeature={_name:\"feature\",_require:[\"browser\",\"log\"],_export:[\"hasFeature\"],hasFeature:function(feature){if(this.env===undefined){this.env=this._sandbox.getEnv()}if(!this.hasFeatureImp[this.env]){this._sandbox.Xcept(\"hasFeature: hasFeature implementation for '\"+this.env+\"' not found\");return false}return this.hasFeatureImp[this.env](feature)},hasFeatureImp:{TEST:function(feature){switch(feature){case\"KeystrokeEncryption\":return true}return true},\"windows/ie\":function(feature){switch(feature){case\"KeystrokeEncryption\":return true}return true},\"windows/firefox\":function(feature){switch(feature){case\"KeystrokeEncryption\":return true}return true},\"windows/chrome\":function(feature){switch(feature){case\"KeystrokeEncryption\":return true}return true},android:function(feature){switch(feature){case\"KeystrokeEncryption\":return false}return true},ios:function(feature){switch(feature){case\"KeystrokeEncryption\":return false}return true},\"mac/firefox\":function(feature){switch(feature){case\"KeystrokeEncryption\":return false}return true},\"mac/chrome\":function(feature){switch(feature){case\"KeystrokeEncryption\":return false}return true},\"mac/safari\":function(feature){switch(feature){case\"KeystrokeEncryption\":return false}return true}}};meta.loadModule(sandbox,modFeature);var modUtils={_name:\"utils\",_require:[\"log\",\"browser\"],_export:[\"indexOfArray\",\"inArray\",\"isArray\",\"stringify\",\"stripQueryString\",\"getQueryString\",\"getSelectionStart\",\"getSelectionEnd\",\"setSelectionPos\",\"compareElements\",\"hasClass\",\"addClass\",\"removeClass\",\"getPasscardAttr\"],indexOfArray:function(target,destArray){for(var i=0;i<destArray.length;++i)if(destArray[i]==target)return i;return-1},inArray:function(target,destArray){return this.indexOfArray(target,destArray)!=-1},isArray:function(obj){return this.getType(obj)==\"array\"},stringify:function(obj){switch(this.getType(obj)){case\"boolean\":return obj.toString();case\"number\":return obj+\"\";case\"string\":return this.quoteString(obj);case\"array\":var data=[];for(var i=0;i<obj.length;i++){data.push(this.stringify(obj[i]))}return\"[\"+data.join(\",\")+\"]\";case\"object\":var data=[];for(var key in obj){if(!!obj.hasOwnProperty&&obj.hasOwnProperty(key)){data.push(this.quoteString(key)+\":\"+this.stringify(obj[key]))}}return\"{\"+data.join(\",\")+\"}\";case\"undefined\":return null;default:this._sandbox.Xcept(\"stringify: Not support this type: \"+this.getType(obj));return\"null\"}},quoteString:function(str){return'\"'+str.replace(/\\\\/g,\"\\\\\\\\\").replace(/\\'/g,\"'\").replace(/\\\"/g,'\\\\\"')+'\"'},getType:function(obj){var type=typeof obj;if(type!=\"object\")return type;var str=Object.prototype.toString.apply(obj);return str.substring(8,str.length-1).toLowerCase()},stripQueryString:function(url){if(!url)return\"\";var m=url.match(/^([^?]*)/);if(m)return m[0];else return\"\"},getQueryString:function(url){if(!url)return\"\";var m=url.match(/\\?(.*)$/);if(m)return m[1];else return\"\"},getSelectionStart:function(element){if(element.selectionStart!==undefined){return element.selectionStart}else{try{var range=this._sandbox._window.document.selection.createRange().duplicate();range.moveEnd(\"character\",element.value.length);if(range.text==\"\")return element.value.length;else return element.value.lastIndexOf(range.text)}catch(e){this._sandbox.Xcept(\"getSelectionStart: IE error \"+e.message);return 0}}},getSelectionEnd:function(element){if(element.selectionEnd!==undefined){return element.selectionEnd}else{try{var range=this._sandbox._window.document.selection.createRange().duplicate();range.moveStart(\"character\",-element.value.length);return range.text.length}catch(e){this._sandbox.Xcept(\"getSelectionEnd: IE error \"+e.message);return 0}}},setSelectionPos:function(element,pos){if(element.setSelectionRange!==undefined){element.focus();element.setSelectionRange(pos,pos)}else{try{var range=element.createTextRange();range.move(\"character\",pos);range.select()}catch(e){this._sandbox.Xcept(\"setSelectionStart: IE error \"+e.message);return}}},compareElements:function(elementA,elementB){if(!elementA||!elementB)return false;if(DP_VERSION>=\"3.0\"){return elementA==elementB}if(this._sandbox.getEnv()==\"windows/firefox\"){return this.firefoxUnwrap(elementA)==this.firefoxUnwrap(elementB)}else{return elementA==elementB}},firefoxUnwrap:function(element){if(XPCNativeWrapper&&XPCNativeWrapper.unwrap)return XPCNativeWrapper.unwrap(element);else return element},hasClass:function(element,className){return element.className.match(new RegExp(\"(\\\\s|^)\"+className+\"(\\\\s|$)\"))},addClass:function(element,className){if(!this.hasClass(element,className))element.className+=\" \"+className},removeClass:function(element,className){if(this.hasClass(element,className)){var reg=new RegExp(\"(\\\\s|^)\"+className+\"(\\\\s|$)\");element.className=element.className.replace(reg,\" \")}},getPasscardAttr:function(passcard){var p=JSON.parse(JSON.stringify(passcard));if(p!=null&&p.data!=null){for(var i=0;i<p.data.length;i++){delete p.data[i].value}}return p||{}}};meta.loadModule(sandbox,modUtils);var modEvent={_name:\"event\",_require:[\"log\"],_export:[\"bindEventListener\",\"triggerEvent\"],bindEventListener:function(element,eventType,listener){if(this.init){this.init();this.init=null}this.bindEventListenerImp(element,eventType,listener)},triggerEvent:function(element,eventType){var sandbox=this._sandbox;if(this.init){sandbox.Xnote(\"init modEvent\");this.init();this.init=null}this.triggerEventImp(element,eventType)},init:function(){var sandbox=this._sandbox;if(sandbox._window.document.addEventListener){this.bindEventListenerImp=function(element,eventType,listener){return element.addEventListener(eventType,listener,false)}}else if(sandbox._window.document.attachEvent){this.bindEventListenerImp=function(element,eventType,listener){if(this.find(element,eventType,listener)!=-1)return;var ieEventHandler=function(e){if(!e)e=window.event;var event={_event:e,type:e.type,target:e.srcElement,currentTarget:element,relatedTarget:e.fromElement?e.fromElement:e.toElement,eventPhase:e.srcElement==element?2:3,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,charCode:e.keyCode,stopPropagation:function(){this._event.cancelBubble=true},preventDefault:function(){this._event.returnValue=false}};if(Function.prototype.call)listener.call(element,event);else{element._tempFunc=listener;element._tempFunc(event);element._tempFunc=null}};element.attachEvent(\"on\"+eventType,ieEventHandler);var info={element:element,eventType:eventType,listener:listener,ieEventHandler:ieEventHandler};var id=this.genID();if(!window._ieEventHandlerInfo)window._ieEventHandlerInfo={};window._ieEventHandlerInfo[id]=info;if(!element._ieEventHandlers)element._ieEventHandlers=[];element._ieEventHandlers.push(id);if(!this.unloadListenerRegistered){this.unloadListenerRegistered=true;window.attachEvent(\"onunload\",this.removeListeners)}}}else{this._sandbox.Xcept(\"event.init: Unable to apply W3C and IE event listener model\");this.bindEventListenerImp=function(){}}if(sandbox._window.document.createEvent){this.triggerEventImp=function(element,eventType){sandbox.Xnote(\"triggerEventImp(createEvent): element = \"+element+\", eventType = \"+eventType);if(eventType==\"click\")return element.click();var event=sandbox._window.document.createEvent(\"Events\");event.initEvent(eventType,true,false);return element.dispatchEvent(event)}}else if(sandbox._window.document.createEventObject){this.triggerEventImp=function(element,eventType){sandbox.Xnote(\"triggerEventImp(createEventObject): element = \"+element+\", eventType = \"+eventType);var event=sandbox._window.document.createEventObject();var ret=element.fireEvent(\"on\"+eventType,event);if(ret&&eventType==\"click\")element.click();return ret}}else{this._sandbox.Xcept(\"event.init: Unable to apply W3C and IE event trigger model\");this.triggerEventImp=function(){return false}}},find:function(element,eventType,listener){var handlers=element._ieEventHandlers;if(!handlers)return-1;for(var i=handlers.length-1;i>=0;--i){var id=handlers[i];var info=window._ieEventHandlerInfo[id];if(info.eventType==eventType&&info.listener==listener)return i}return-1},removeListeners:function(){var handlers=window._ieEventHandlerInfo;for(id in handlers){var info=handlers[id];info.element.detachEvent(\"on\"+info.eventType,info.ieEventHandler);delete window._ieEventHandlerInfo[id]}},genID:function(){return\"h\"+this.id++},id:0};meta.loadModule(sandbox,modEvent);var modDom={_name:\"dom\",_require:[\"utils\",\"log\",\"event\"],_export:[\"getLoginFormData\",\"getElementsByTagName\",\"getElementsByName\",\"getElementById\",\"getElementByIdOrName\",\"getElementByXPath\",\"getElementsByXPath\",\"getDomain\",\"getLocation\",\"getFormAction\",\"getFaviconURL\",\"getTitle\",\"serializeForm\",\"deserializeForm\",\"submitForm\",\"serializeInput\",\"deserializeFormInput\",\"deserializeInput\",\"isInputInForm\",\"hookFormSubmit\",\"serializePasswordForm\",\"serializeSignupForm\",\"forEach\",\"isVisible\",\"normalizeFormAction\",\"setValueWithKeyEvent\",\"injectScriptIntoPage\",\"getInputElementsByType\",\"getFirstTextInput\",\"getFirstPasswordInput\",\"getNthTextInput\",\"serializeInputData\",\"isEmptyObject\",\"getInputElementByIdOrName\",\"getSubmitElement\"],_getElementsByXPath:function(xpath){var sandbox=this._sandbox;var ptn=/\\/([^\\/\\[]+)(\\[((@[^=]+='[^']+')|(\\d+))\\])?/g;var token;var elm=[sandbox._window.document];while(token=ptn.exec(xpath)){var tag=token[1].toUpperCase();var attr=token[4];var order=token[5];sandbox.Xchkpt(\"_getElementsByXPath: tag: \"+tag+\" attr: \"+attr+\" order: \"+order);var elm2=[];for(var i=0;i<elm.length;++i){var currentElement=elm[i];sandbox.Xchkpt(\"_getElementsByXPath: currentElement: \"+currentElement+\" tag: \"+currentElement.tagName);if(currentElement.tagName==\"IFRAME\"||currentElement.tagName==\"FRAME\"){if(!currentElement.contentDocument&&currentElement.contentWindow){currentElement=currentElement.contentWindow.document}else{currentElement=currentElement.contentDocument}}if(!currentElement)continue;if(attr){sandbox.Xchkpt(\"_getElementsByXPath: use attr: \"+attr);var childNodes=sandbox.getElementsByTagName(tag,currentElement);sandbox.Xchkpt(\"_getElementsByXPath: childNodes#: \"+childNodes.length);for(var j=0;j<childNodes.length;++j)if(this.filterElement(childNodes[j],attr))elm2.push(childNodes[j])}else{sandbox.Xchkpt(\"_getElementsByXPath: not use attr\");var childNodes=[];for(var j=0;j<currentElement.childNodes.length;++j)if(currentElement.childNodes[j].tagName==tag)childNodes.push(currentElement.childNodes[j]);sandbox.Xchkpt(\"_getElementsByXPath: childNodes#: \"+childNodes.length);if(order){sandbox.Xchkpt(\"_getElementsByXPath: use order: \"+order);var o=0;o=parseInt(order)-1;if(o<childNodes.length)elm2.push(childNodes[o])}else{sandbox.Xchkpt(\"_getElementsByXPath: use all child\");for(var j=0;j<childNodes.length;++j)elm2.push(childNodes[j])}}}elm=elm2;sandbox.Xchkpt(\"_getElementsByPath: elm#: \"+elm.length)}return elm},getElementsByTagName:function(tagName,parentNode){var sandbox=this._sandbox;var node;if(!parentNode)node=sandbox._window.document;else node=parentNode;return node.getElementsByTagName(tagName)},getElementsByName:function(name){return this._sandbox._window.document.getElementsByName(name)},getElementById:function(id){return this._sandbox._window.document.getElementById(id)},getInputElementByIdOrName:function(idOrName){if(idOrName===\"\"){return null}var elements=this.getElementsByName(idOrName);if(elements&&elements.length>0){for(i=0;i<elements.length;i++){if(elements[i].tagName!=null&&elements[i].tagName.toUpperCase()==\"INPUT\")return elements[i]}}var inputs=sandbox.getElementsByTagName(\"input\");for(var i=0;i<inputs.length;i++){var theInput=inputs[i];if(theInput.id!=null&&theInput.id!=\"\"&&theInput.id==idOrName){return theInput}}return null},getElementByIdOrName:function(idOrName){var element=this.getElementById(idOrName);if(element)return element;var element=this.getElementsByName(idOrName);if(element&&element.length>0)return element[0];return null},getElementByXPath:function(xpath){var elms=this._getElementsByXPath(xpath);if(elms&&elms.length==1)return elms[0];else return null},getElementsByXPath:function(xpath){var elms=this._getElementsByXPath(xpath);if(elms&&elms.length!=0)return elms;else return null},filterElement:function(elm,conditions){var ptn=/@([^=]+)='([^']+)'/g;var cond;while(cond=ptn.exec(conditions)){var attr=cond[1];var value=cond[2];var elmAttr=\"\";if(sandbox.getEnv()==\"windows/ie\"){elmAttr=elm.getAttribute(attr,2)}else{elmAttr=elm.getAttribute(attr)}if(value==elmAttr||attr==\"class\"&&value==elm.className){sandbox.Xchkpt(\"filterElement: return true\");return true}}return false},getURI:function(){var href=this.getLocation();var m=href.match(/^(([^:\\/?#]+):)?(\\/\\/([^\\/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?/);var res={};res.protocal=m[2];res.server=m[4];res.path=m[5];res.query=m[7];res.hash=m[9];return res},getAbsoluteURL:function(url){var URI=this.getURI();if(/^https?:\\/\\//.test(url)){return url}else if(/^\\/\\//.test(url)){return URI.protocal+\":\"+url}else if(/^\\//.test(url)){return URI.protocal+\"://\"+URI.server+url}else if(/^\\./.test(url)){var modifiedURL=url;var path=URI.path.replace(/\\/[^\\/]*$/,\"\");while(true){if(modifiedURL.indexOf(\"./\")==0){modifiedURL=modifiedURL.substring(2)}else if(modifiedURL.indexOf(\"../\")==0){modifiedURL=modifiedURL.substring(3);path=path.replace(/\\/[^\\/]*$/,\"\")}else if(modifiedURL.indexOf(\".\")==0){modifiedURL=modifiedURL.substring(1)}else{break}}return URI.protocal+\"://\"+URI.server+path+\"/\"+modifiedURL}else if(/^\\?/.test(url)){var path=URI.path.replace(/\\/[^\\/]*$/,\"\");return URI.protocal+\"://\"+URI.server+path+\"/\"+url}else if(/^#/.test(url)){return URI.protocal+\"://\"+URI.server+URI.path+(URI.query?\"?\"+URI.query:\"\")+url}else{var path=URI.path.replace(/\\/[^\\/]*$/,\"\");return URI.protocal+\"://\"+URI.server+path+\"/\"+url}},getDomain:function(){return this._sandbox._window.document.domain},getLocation:function(){return this._sandbox._window.document.location.href},getFormAction:function(form){if(!form)return\"\";var action=form.getAttribute(\"action\");action=action?action:\"\";return this.normalizeFormAction(action)},getFaviconURL:function(){var sandbox=this._sandbox;var links=sandbox.getElementsByTagName(\"link\");for(var i=0;i<links.length;++i){if(links[i].rel&&/^(shortcut )?icon$/i.test(links[i].rel)){var href=links[i].getAttribute(\"href\");if(!href)continue;return this.getAbsoluteURL(href)}}return this.getAbsoluteURL(\"/favicon.ico\")},getTitle:function(){return this._sandbox._window.document.title},getLoginFormData:function(form){var sandbox=this._sandbox;if(!form){sandbox.Xcept(\"getLoginFormData(form): parameter form is null, returns {}.\");return{}}var inputs=sandbox.getElementsByTagName(\"input\");var data=[];var accountSet=false;var passwordSet=false;for(var i=0;i<inputs.length;++i){if(!sandbox.isInputInForm(inputs[i],form))continue;var inputData=this.serializeInput(inputs[i]);if(inputData){if(inputData.disabled){sandbox.Xnote(\"serializeForm: input button is disabled, skip input: \"+inputData.name);continue}if(!accountSet&&inputData.type!=\"password\"){inputData.account=true;accountSet=true}if(!passwordSet&&inputData.type==\"password\"){passwordSet=true}inputData.value=\"\";data.push(inputData)}}if(!accountSet||!passwordSet){sandbox.Xnote(\"serializeForm: account or password is not set\");return null}return data},serializeForm:function(form){var sandbox=this._sandbox;if(!form){sandbox.Xcept(\"serializeForm: form not found\");return null}var inputs=sandbox.getElementsByTagName(\"input\");var data=[];var accountSet=false;var passwordSet=false;for(var i=0;i<inputs.length;++i){if(!sandbox.isInputInForm(inputs[i],form)||!sandbox.isVisible(inputs[i]))continue;var inputData=this.serializeInput(inputs[i]);if(inputData){if(!inputData.value||inputData.disabled){sandbox.Xnote(\"serializeForm: value not set or input button is disabled, skip input: \"+inputData.name);continue}if(!accountSet&&inputData.type!=\"password\"){inputData.account=true;accountSet=true}if(!passwordSet&&inputData.type==\"password\"){passwordSet=true}data.push(inputData)}}if(!accountSet||!passwordSet){sandbox.Xnote(\"serializeForm: account or password is not set\");return null}return data},serializeInputData:function(lowerBoundCriteria){var sandbox=this._sandbox;var data=[];var accountReady=false;var passwordReady=false;var lowTextCount=1,textCount=0;var lowPasswordCount=1,passwordCount=0;var i=0;if(lowerBoundCriteria!=null){if(lowerBoundCriteria.textCount&&lowerBoundCriteria.textCount>=0)lowTextCount=lowerBoundCriteria.textCount;if(lowerBoundCriteria.passwordCount&&lowerBoundCriteria.passwordCount>=0)lowPasswordCount=lowerBoundCriteria.passwordCount}var inputs=sandbox.getElementsByTagName(\"input\");for(i=0;i<inputs.length;++i){if(!sandbox.validInputData(inputs[i]))continue;var inputData=this.serializeInput(inputs[i]);if(inputData!=null){if(!inputData.value||inputData.disabled){sandbox.Xnote(\"[serializeInputData] Value not set or input button is disabled, skip this input: \"+inputData.name);continue}if(!accountReady&&inputData.type!=\"password\"){inputData.account=true;accountReady=true}if(!passwordReady&&inputData.type==\"password\"){passwordReady=true}if(inputData.type==\"password\")passwordCount++;else textCount++;data.push(inputData)}}if(textCount<lowTextCount||passwordCount<lowPasswordCount){sandbox.Xnote(\"[serializeInputData] Account or password does not meet lower-bound criteria.\");return null}return data},serializePasswordForm:function(form){var sandbox=this._sandbox;if(!form){sandbox.Xcept(\"serializeForm: form not found\");return null}var inputs=sandbox.getElementsByTagName(\"input\");var data=[];var accountSet=false;var passwordType=0;for(var i=0;i<inputs.length;++i){if(!sandbox.isInputInForm(inputs[i],form))continue;var inputData=this.serializeInput(inputs[i]);if(inputData){if(!inputData.value){sandbox.Xnote(\"serializeForm: value not set, skip input: \"+inputData.name);continue}if(!accountSet&&inputData.type!=\"password\"){inputData.account=true;accountSet=true}if(inputData.type==\"password\"){if(passwordType==0)inputData.oldPassword=true;else if(passwordType==1)inputData.newPassword=true;else if(passwordType==2)inputData.confirmPassword=true;passwordType++}data.push(inputData)}}return data},serializeSignupForm:function(form){var sandbox=this._sandbox;if(!form){sandbox.Xcept(\"serializeSignupForm: form not found\");return null}var inputs=sandbox.getElementsByTagName(\"input\");var signupPattern=sandbox.signupPattern;sandbox.Xnote(\"signupPattern = \"+sandbox.stringify(signupPattern));var signupAcc=signupPattern.signupForm.account||\"\";var loginAcc=signupPattern.loginForm.account||\"\";sandbox.Xnote(\"signupForm.account = \"+signupAcc+\", loginForm.account = \"+loginAcc);var signupPwd=signupPattern.signupForm.password||\"\";var loginPwd=signupPattern.loginForm.password||\"\";sandbox.Xnote(\"signupForm.password = \"+signupPwd+\", loginForm.password = \"+loginPwd);var accountField=null;var passwordField=null;sandbox.forEach(form,function(input){if(accountField!=null&&passwordField!=null){return}if(!sandbox.validInput(input)){sandbox.Xnote(\"input type = \"+input.type+\", disabled = \"+input.disabled+\" is not valid\");return}var inputData=sandbox.serializeInput(input);if(inputData){if(!inputData.value){sandbox.Xnote(\"serializeSignupForm: value not set, skip input: \"+inputData.name);return}if(inputData.type!==\"password\"){if(signupAcc!=null&&(signupAcc===inputData._id||signupAcc===inputData.name)){inputData.name=loginAcc?loginAcc:inputData.name;inputData.account=true;accountField=inputData}else if(accountField==null){inputData.name=\"USERNAME\";inputData.account=true;accountField=inputData}}else if(inputData.type===\"password\"){if(signupPwd!=null&&(signupPwd===inputData._id||signupPwd===inputData._name)){inputData.name=loginPwd?loginPwd:inputData.name;passwordField=inputData}else if(passwordField==null){inputData.name=\"PASSWORD\";passwordField=inputData}}}});if(accountField==null||passwordField==null){sandbox.Xnote(\"serializeSignupForm: account or password is not set\");return null}return[accountField,passwordField]},serializeInput:function(input,allTypes){if(!input){this._sandbox.Xcept(\"serializeInput: input is null\");return null}var type=input.type;if(type===\"tel\"||type===\"email\"){type=\"text\"}if(!allTypes){if(!sandbox.validInput(input))return null}var res={};res.type=type;res.name=input.name?input.name:input.id;res.value=input.value;res._id=input.id;res._name=input.name;return res},deserializeForm:function(form,passcardData){var sandbox=this._sandbox;var createdManually=false;var posPASSWORD=0;for(var i=0;i<passcardData.length;i++){if(passcardData[i].type==\"password\"&&passcardData[i].name==\"PASSWORD\"){posPASSWORD=i;createdManually=true;break}}var fillAll=true;if(createdManually){for(var i=0;i<passcardData.length;++i){if(passcardData[i].type==\"password\"){if(i==posPASSWORD){if(!this.deserializeFormInput(form,passcardData[i]))fillAll=false}}else{if(!this.deserializeFormInput(form,passcardData[i]))fillAll=false}}}else{for(var i=0;i<passcardData.length;++i){if(!this.deserializeFormInput(form,passcardData[i]))fillAll=false}}return fillAll},deserializeFormInput:function(form,field){var sandbox=this._sandbox;if(field==null){return true}if(field.type==\"deleted\"){sandbox.Xnote(\"deserializeFormInput: skip deleted field: \"+field.name);return true}var name=field.name;var value=field.value;for(var i=0;i<form.length;i++){if((name===form[i].name||name===form[i].id)&&sandbox.isVisible(form[i])){sandbox.Xnote(\"deserializeFormInput: matched\");sandbox.setValueWithKeyEvent(form[i],value);return true}}if(field.type===\"password\"){sandbox.Xnote(\"[modDom][deserializeFormInput] Guess first password field as password\");var password=this.getFirstPasswordInput(form);sandbox.Xnote(\"[modDom][deserializeFormInput] 1st password: \"+password.name);if(password){sandbox.setValueWithKeyEvent(password,value);return true}}else{sandbox.Xnote(\"[modDom][deserializeFormInput] Guess first text field as account\");var account=this.getFirstTextInput(form);sandbox.Xnote(\"[modDom][deserializeFormInput] 1st account: \"+account.name);if(account){sandbox.setValueWithKeyEvent(account,value);return true}}return false},deserializeInput:function(data,inputTarget){var sandbox=this._sandbox;if(data.type==\"deleted\"){sandbox.Xnote(\"deserializeInput: skip deleted field: \"+data.name);return true}var element;if(inputTarget!=null){element=inputTarget}else{element=this.getElementByIdOrName(data.name)}if(element){sandbox.Xnote(\"deserializeInput: fill in field: \"+element.name);sandbox.setValueWithKeyEvent(element,data.value);return true}return false},getInputElementsByType:function(type,inputs){var sandbox=this._sandbox;var elements=[];for(var i=0;i<inputs.length;++i){if(inputs[i].type==type){elements.push(inputs[i])}}return elements},getNthTextInput:function(nth,inputs){var sandbox=this._sandbox;if(nth>=inputs.length)return null;var counter=0;var acceptedTypes=\"text email tel\".split(\" \");for(var i=0;i<inputs.length;++i){if(sandbox.inArray(inputs[i].type,acceptedTypes)){if(counter++<nth)continue;return inputs[i]}}return null},getFirstTextInput:function(inputs){return this.getNthTextInput(0,inputs)},getFirstPasswordInput:function(inputs){var sandbox=this._sandbox;for(var i=0;i<inputs.length;++i){if(inputs[i].type==\"password\")return inputs[i]}return null},submitForm:function(form){var sandbox=this._sandbox;sandbox.Xchkpt(\"submitForm: entering\");if(!form){sandbox.Xcept(\"submitForm(form): form==null, return false.\");return false}var result=true;var submitElement=this.getSubmitElement(form);if(submitElement){sandbox.Xnote(\"submitForm: found submit element: \"+submitElement.id);try{result=false;sandbox.bindEventListener(submitElement,\"click\",function(){result=true});submitElement.click()}catch(e){sandbox.Xnote(\"submitForm: click submit element failed: \"+e.message);result=false}}else{result=false}if(result==false){try{sandbox.Xnote(\"submitForm: calling submit()\");form.submit();result=true}catch(e){sandbox.Xnote(\"submitForm: submit() failed \"+e.message);result=false}}if(result==false){try{sandbox.Xnote(\"submitForm: calling prototype.submit()\");HTMLFormElement.prototype.submit.apply(form);result=true}catch(e){sandbox.Xnote(\"submitForm: prototype.submit() failed \"+e.message);result=false}}if(result==false){try{sandbox.Xnote(\"submitForm: create form element and apply submit\");sandbox._window.document.createElement(\"form\").submit.apply(form);result=true}catch(e){sandbox.Xnote(\"submitForm: create form.submit.apply failed \"+e.message);result=false}}sandbox.Xnote(\"submitForm: submit result: \"+result);return result},isInputInForm:function(input,form){if(input.form)return this._sandbox.compareElements(input.form,form);else return false},getSubmitElement:function(form){var sandbox=this._sandbox;var inputs=sandbox.getElementsByTagName(\"input\");for(var i=0;i<inputs.length;++i){if(!sandbox.isInputInForm(inputs[i],form))continue;if(inputs[i].type==\"submit\"||inputs[i].type==\"image\")return inputs[i]}var buttons=sandbox.getElementsByTagName(\"button\");for(var i=0;i<buttons.length;++i){if(!sandbox.isInputInForm(buttons[i],form))continue;if(buttons[i].type==\"submit\")return buttons[i]}return null},hookFormSubmit:function(form,storeDataFunction){var sandbox=this._sandbox;try{if(!form._submit){form._submit=form.submit;form.submit=function(){form.submit=form._submit;storeDataFunction();form.submit()}}}catch(e){sandbox.Xnote(\"hookFormSubmit: unable to replace the original submit function, \"+e.message)}},getFormIndex:function(form){var sandbox=this._sandbox;var doc=sandbox._window.document;for(var i=0;i<doc.forms.length;++i){if(doc.forms[i]==form)return i}return-1},forEach:function(htmlElems,func){var i=0;for(i=0;i<htmlElems.length;i++){func(htmlElems[i],i,htmlElems)}},isVisible:function(elem){var sandbox=this._sandbox;var window=sandbox._window;var document=sandbox._window.document;var x=window.pageXOffset?window.pageXOffset+window.innerWidth-1:0,y=window.pageYOffset?window.pageYOffset+window.innerHeight-1:0,relative=!!(!x&&!y||!document.elementFromPoint(x,y));function inside(child,parent){while(child){if(child===parent)return true;child=child.parentNode}return false}return function(){if(document.hidden||elem.offsetWidth==0||elem.offsetHeight==0||elem.style.visibility==\"hidden\"||elem.style.display==\"none\"||elem.style.opacity===0)return false;var rect=elem.getBoundingClientRect();if(relative){if(!inside(document.elementFromPoint(rect.left+elem.offsetWidth/2,rect.top+elem.offsetHeight/2),elem))return false}else if(!inside(document.elementFromPoint(rect.left+elem.offsetWidth/2+window.pageXOffset,rect.top+elem.offsetHeight/2+window.pageYOffset),elem)||(rect.top+elem.offsetHeight/2<0||rect.left+elem.offsetWidth/2<0||rect.bottom-elem.offsetHeight/2>(window.innerHeight||document.documentElement.clientHeight)||rect.right-elem.offsetWidth/2>(window.innerWidth||document.documentElement.clientWidth)))return false;if(window.getComputedStyle||elem.currentStyle){var el=elem,comp=null;while(el){if(el===document){break}else if(!el.parentNode)return false;comp=window.getComputedStyle?window.getComputedStyle(el,null):el.currentStyle;if(comp&&(comp.visibility==\"hidden\"||comp.display==\"none\"||typeof comp.opacity!==\"undefined\"&&comp.opacity!=1))return false;el=el.parentNode}}return true}(elem)},normalizeFormAction:function(formAction){formAction=this.getAbsoluteURL(formAction);return this._sandbox.stripQueryString(formAction)},setValueWithKeyEvent:function(elem,value){var sandbox=this._sandbox;var withKey=\"_mobile_with_key_events\";if(withKey===\"_mobile_\"+\"with_key_events\"){withKey=true}else{withKey=false}elem.value=\"\";if(withKey){sandbox.triggerEvent(elem,\"click\");sandbox.triggerEvent(elem,\"focus\");for(var i=0;i<value.length;i++){sandbox.triggerEvent(elem,\"keydown\");\nelem.value+=value[i];sandbox.triggerEvent(elem,\"input\");sandbox.triggerEvent(elem,\"selectionchange\");sandbox.triggerEvent(elem,\"change\")}sandbox.triggerEvent(elem,\"blur\")}else{sandbox.triggerEvent(elem,\"focus\");for(var i=0;i<value.length;i++){sandbox.triggerEvent(elem,\"keydown\");elem.value+=value[i];sandbox.triggerEvent(elem,\"input\");sandbox.triggerEvent(elem,\"selectionchange\");sandbox.triggerEvent(elem,\"change\")}}},injectScriptIntoPage:function(script){var scriptTag=document.createElement(\"script\");scriptTag.text=script;document.body.appendChild(scriptTag);document.body.removeChild(scriptTag)},isEmptyObject:function(obj){for(var prop in obj){if(obj.hasOwnProperty(prop))return false}return true}};meta.loadModule(sandbox,modDom);var modHeuristics={_name:\"heuristics\",_require:[\"dom\",\"utils\",\"log\"],_export:[\"isDangerousForm\",\"traverseForms\",\"getLoginFormIndex\",\"isLoginFailed\",\"isLoginForm\",\"isAutoLearnForm\",\"isPasswordChangeForm\",\"getFormType\",\"validInput\",\"validInputData\",\"fuzzyIsRecordable\",\"fuzzyFindSubmitElements\",\"fuzzySubmit\",\"fuzzyFindValidInputElements\",\"isDataProvided\",\"setInputDataProvidedStatus\",\"getInputDataProvidedStatus\"],isDangerousForm:function(form){var sandbox=this._sandbox;sandbox.Xnote(\"[modHeuristics][isDangerousForm] Enter\");if(form==null){sandbox.Xnote(\"[modHeuristics][isDangerousForm] invalid parameter: form==null\");return false}var isDangerous=false;var submitElement=sandbox.getSubmitElement(form);var formMethod=form.method;if(submitElement===null&&formMethod.toLowerCase()===\"get\"){sandbox.Xchkpt(\"[modHeuristics][isDangerousForm] Found a DANGEROUS form!\");isDangerous=true}return isDangerous},traverseForms:function(typeToFind,actionOnForm){var sandbox=this._sandbox;sandbox.Xnote(\"[Enter] ===============>> traverseForms()\");if(!actionOnForm){sandbox.Xcept(\"traverseForms(): Parameter error, 'actionOnForm' not defined.\");return}var nFormApplied=0;var nIndex=0;var forms=sandbox.getElementsByTagName(\"form\");sandbox.Xnote(\"traverseForms(), total form # is \"+forms.length+\". ====> Locate form type = \"+typeToFind);sandbox.forEach(forms,function(form,_,forms){var formType=sandbox.getFormType(form);sandbox.Xnote(\"traverseForms(), index = \"+nIndex++ +\", formType is \"+formType);if(formType==typeToFind){sandbox.Xnote(\"traverseForms(): ====> \"+ ++nFormApplied+\" action applied.\");actionOnForm(form);return}});sandbox.Xnote(\"[Leave] <<=============== traverseForms(), totally \"+nFormApplied+\" form(s) applied given action.\")},fuzzyFindValidInputElements:function(givenInputs,func){var sandbox=this._sandbox;var validInputs=[];var inputs=givenInputs;if(!inputs){inputs=sandbox.getElementsByTagName(\"input\")}for(var i=0;i<inputs.length;i++){if(!sandbox.validInput(inputs[i]))continue;validInputs.push(inputs[i]);if(func!=null&&typeof func===\"function\"){func(inputs[i])}}return validInputs},fuzzyIsRecordable:function(){var sandbox=this._sandbox;sandbox.Xnote(\"Enter [modHeuristics][fuzzyIsRecordable]\");var forms=this.fuzzyGetRecordableForms();if(forms.login.length>0)return true;if(forms.learning.length>0)return true;var password=0;var text=0;var inputs=sandbox.getElementsByTagName(\"input\");for(var i=0;i<inputs.length;i++){if(!sandbox.validInput(inputs[i])){continue}if(inputs[i].type===\"password\"){sandbox.Xnote(\"[modHeuristics][fuzzyIsRecordable] A valid password input: \"+inputs[i].id||inputs[i].name||\"(no name password elm)\");++password}else{sandbox.Xnote(\"[modHeuristics][fuzzyIsRecordable] A valid text input: \"+inputs[i].id||inputs[i].name||\"(no name text elm)\");++text}}if(password>0&&text>0){sandbox.Xnote(\"[modHeuristics][fuzzyIsRecordable] password>0 && text>0, probably recordable.\");return true}sandbox.Xnote(\"[modHeuristics][fuzzyIsRecordable] password+text < 2, not recordable.\");return false},fuzzyGetRecordableForms:function(){var sandbox=this._sandbox;sandbox.Xnote(\"Enter [modHeuristics][fuzzyGetRecordableForms]\");var loginForms=[],learningForms=[],changePwdForms=[],unknownForms=[];var formIdx=-1;var forms=sandbox.getElementsByTagName(\"form\");sandbox.forEach(forms,function(form,_,forms){var iFor=++formIdx;var formType=sandbox.getFormType(form);switch(formType){case FORM_TYPE.LOGIN:if(sandbox.isVisible(form)===true){sandbox.Xnote(\"Visible LOGIN form found\");loginForms.push(form)}break;case FORM_TYPE.FORM_FILLING:if(sandbox.isVisible(form)===true){sandbox.Xnote(\"Visible LEARNING form found\");learningForms.push(form)}break;case FORM_TYPE.PASSWORD_CHANGE:if(sandbox.isVisible(form)===true){sandbox.Xnote(\"Visible PASSWORD_CHANGE form found\");changePwdForms.push(form)}break;default:if(sandbox.isVisible(form)===true){sandbox.Xnote(\"Visible UNKNOWN form found\");unknownForms.push(form);return}break}});var availableForms={login:loginForms,learning:learningForms,changePassword:changePwdForms,unknown:unknownForms};sandbox.Xnote(\"[modHeuristics][fuzzyGetRecordableForms] return forms:\\n\"+sandbox.stringify(availableForms));return availableForms},fuzzyFindSubmitElements:function(inputs,func){var sandbox=this._sandbox;var submitInputs=[];var buttonInputs=[];var imageInputs=[];var foundElements=[];submitInputs=sandbox.getInputElementsByType(\"submit\",inputs);buttonInputs=sandbox.getInputElementsByType(\"button\",inputs);imageInputs=sandbox.getInputElementsByType(\"image\",inputs);foundElements=submitInputs.concat(buttonInputs).concat(imageInputs);if(func!=null&&typeof func===\"function\"){for(var i=0;i<foundElements.length;i++){func(foundElements[i])}}return foundElements},fuzzySubmit:function(passcard,form){var sandbox=this._sandbox;if(passcard!=null&&passcard.triggerElement!=null&&passcard.triggerElement.name!=\"\"){var triggerName=passcard.triggerElement.name;if(triggerName!=\"keystrokeEnter\"){var triggerElm=sandbox.getElementByIdOrName(triggerName);if(triggerElm!=null){sandbox.triggerEvent(triggerElm,\"click\");return triggerElm}}}var inputs=sandbox.getElementsByTagName(\"input\",form);var submitElements=sandbox.fuzzyFindSubmitElements(inputs);if(submitElements.length<=2){sandbox.triggerEvent(submitElements[0],\"click\");return submitElements[0]}return null},getLoginFormIndex:function(forms){var sandbox=this._sandbox;var formIdx=-1;var hasLoginForm=false;sandbox.Xnote(\"Enter [modHeuristics][getLoginFormIndex] Locates 1st *visible* LOGIN form, returns index (0-based) in DOM\");if(!forms){forms=sandbox.getElementsByTagName(\"form\")}sandbox.forEach(forms,function(form,_,forms){var iFor=++formIdx;var formType=sandbox.getFormType(form);switch(formType){case FORM_TYPE.LOGIN:sandbox.Xnote(iFor+\") >> case FORM_TYPE.LOGIN. Form action = \"+(form.action||\"()\")+\", id = \"+(form.id||\"(\")+\", name\"+(form.name||\"()\"));sandbox.Xnote(\"\t Make sure the form is visible...\");if(sandbox.isVisible(form)===true){sandbox.Xnote(\"Visible LOGIN form found, STOP iterating to next form!\");hasLoginForm=true;return}sandbox.Xnote(\"The login form is invisible, continue iterating to next form.\");break;case FORM_TYPE.FORM_FILLING:sandbox.Xnote(iFor+\">> case FORM_TYPE.FORM_FILLING. Form action = \"+(form.action||\"()\")+\", id = \"+(form.id||\"()\")+\", name\"+(form.name||\"()\"));break;case FORM_TYPE.PASSWORD_CHANGE:sandbox.Xnote(iFor+\">> case FORM_TYPE.PASSWORD_CHANGE. Form action = \"+(form.action||\"()\")+\", id = \"+(form.id||\"()\")+\", name\"+(form.name||\"()\"));break;default:sandbox.Xnote(iFor+\">> Invalid case, unknown form type. Form action = \"+(form.action||\"()\")+\", id = \"+(form.id||\"()\")+\", name\"+(form.name||\"()\"));break}});var retVal=hasLoginForm?formIdx:-1;sandbox.Xnote(\"[modHeuristics][getLoginFormIndex] Total form # is \"+forms.length+\", LOGIN_FORM index (-1 means no login form) = \"+retVal);return retVal},isLoginFailed:function(){var sandbox=this._sandbox;var inputs=sandbox.getElementsByTagName(\"input\");var password=0;for(var i=0;i<inputs.length;++i){if(inputs[i].type==\"password\")++password}return password===FORM_TYPE.LOGIN},validInput:function(input){if(input.disabled===true)return false;var handlingTypes=[\"text\",\"tel\",\"email\",\"password\"];return sandbox.inArray(input.type,handlingTypes)},validInputData:function(input,checkInputType){var check=checkInputType===undefined||checkInputType===null?true:checkInputType!=false;if(check&&!this.validInput(input))return false;var val=input.value;if(val==null||val==\"\")return false;return true},getFormType:function(form){if(!form)return FORM_TYPE.UNKNOWN;var password=0;var text=0;sandbox.forEach(form,function(input,_,form){if(!sandbox.validInput(input)||!sandbox.isVisible(input)){return}if(input.type===\"password\"){++password}else if(input.type===\"text\"||input.type===\"tel\"||input.type===\"email\"){++text}});sandbox.Xnote(\"getFormType(): text # = \"+text+\", password # = \"+password);var type=FORM_TYPE.UNKNOWN;if(text>0&&password>0&&text+password<=3){type=FORM_TYPE.LOGIN}else if(DP_VERSION!==null&&(text===0&&password===3)){type=FORM_TYPE.PASSWORD_CHANGE}else if(text+password>3){type=FORM_TYPE.FORM_FILLING}sandbox.Xnote(\"getFormType(): return \"+type);return type},isLoginForm:function(form){return this.getFormType(form)===FORM_TYPE.LOGIN},isAutoLearnForm:function(form){return this.getFormType(form)===FORM_TYPE.FORM_FILLING},isPasswordChangeForm:function(form){return this.getFormType(form)===FORM_TYPE.PASSWORD_CHANGE},setInputDataProvidedStatus:function(elmInput,dataProvided){if(elmInput==null){sandbox.Xnote(\"[WARN] setInputDataProvidedStatus(), param 'elmInput' is null.\");return}else if(elmInput.nodeName!==\"INPUT\"){sandbox.Xnote(\"[WARN] setInputDataProvidedStatus(), param 'elmInput' is not an INPUT.\");return}if(typeof dataProvided!=\"string\"){sandbox.Xnote(\"[WARN] setInputDataProvidedStatus(), param 'dataProvided' is not a string.\");return}if(elmInput.name!=null&&elmInput.name!==\"\"){DATA_READY_STATUS[elmInput.name]=dataProvided}else if(elmInput.id!=null&&elmInput.id!==\"\"){DATA_READY_STATUS[elmInput.id]=dataProvided}else if(elmInput.type===\"text\"||elmInput.type===\"tel\"||elmInput.type===\"email\"){DATA_READY_STATUS[\"USERNAME\"]=dataProvided}else if(elmInput.type===\"password\"){DATA_READY_STATUS[\"PASSWORD\"]=dataProvided}else{sandbox.Xnote(\"[WARN] setInputDataProvidedStatus(), given input element has no identity.\")}sandbox.Xnote(\"setInputDataProvidedStatus(), DATA_READY_STATUS === \"+sandbox.stringify(DATA_READY_STATUS))},getInputDataProvidedStatus:function(elmInput){if(elmInput==null){sandbox.Xnote(\"[WARN] getInputDataProvidedStatus(), param 'elmInput' is null.\");return}else if(elmInput.nodeName!==\"INPUT\"){sandbox.Xnote(\"[WARN] getInputDataProvidedStatus(), param 'elmInput' is not an INPUT.\");return}if(elmInput.name!=null&&elmInput.name!=\"\"){return DATA_READY_STATUS[elmInput.name]}else if(elmInput.id!=null&&elmInput.id!=\"\"){return DATA_READY_STATUS[elmInput.id]}else if(elmInput.type===\"text\"||elmInput.type===\"tel\"||elmInput.type===\"email\"){return DATA_READY_STATUS[\"USERNAME\"]}else if(elmInput.type===\"password\"){return DATA_READY_STATUS[\"PASSWORD\"]}else{sandbox.Xnote(\"[WARN] getInputDataProvidedStatus(), given input element has no identity.\")}},isDataProvided:function(data){sandbox.Xnote(\"isDataProvided() is to traverse each collected input and check if its value is valuable.\");var result={dataProvided:\"no\",hasValue:false};if(data==null){sandbox.Xnote(\"isDataProvided(data), data is NULL, return 'no'.\");return result}if(data.length===0||data.length==null){sandbox.Xnote(\"isDataProvided(data), data.length===0, return 'no'.\");return result}sandbox.Xnote(\"isDataProvided(data), data.length===\"+data.length);sandbox.Xnote(\"isDataProvided(), initially dataReadyFlag = yes\");var dataReadyFlag=\"yes\";for(var i=0;i<data.length;i++){if(dataReadyFlag===\"no\"){sandbox.Xnote(\"isDataProvided(), skip checking because there is a field w/o user's input.\");break}var input=data[i];sandbox.Xnote(\"isDataProvided(), check element '\"+input._id+\"'\");var dataElm=sandbox.getInputElementByIdOrName(input._id);if(!dataElm){sandbox.Xnote(\"isDataProvided(), check element '\"+input._name+\"'\");dataElm=sandbox.getInputElementByIdOrName(input._name)}if(!dataElm){sandbox.Xnote(\"isDataProvided(), check element '\"+input.name+\"'\");dataElm=sandbox.getInputElementByIdOrName(input.name)}if(!dataElm){sandbox.Xnote(\"isDataProvided(), didn't find input '\"+input.name+\"', continue to search next one.\");dataReadyFlag=\"no\"}else{var dataProvided=sandbox.getInputDataProvidedStatus(dataElm);result.dataProvided=dataProvided;var hasValue=dataElm.value!=null&&dataElm.value!=\"\";result.hasValue=hasValue;sandbox.Xnote(\"isDataProvided(), dataProvided===\"+dataProvided+\", hasValue===\"+hasValue);if(dataProvided===\"no\"){sandbox.Xnote(\"isDataProvided(), dataReadyFlag = no.\");dataReadyFlag=\"no\"}}}sandbox.Xnote(\"isDataProvided(), return: \"+sandbox.stringify(result));return result}};meta.loadModule(sandbox,modHeuristics);var modKeystrokeEncryption={_name:\"keystroke-encryption\",_require:[\"callback\",\"utils\",\"log\",\"feature\"],_export:[\"bindEncryptionEvents\"],bindEncryptionEvents:function(element,filterFunc){this._sandbox.Xnote(\"No encryption features available in v3\")}};meta.loadModule(sandbox,modKeystrokeEncryption);var modPtnlessRecord={_name:\"ptnless-record\",_require:[\"callback\",\"dom\",\"utils\",\"keystroke-encryption\",\"log\",\"heuristics\"],_export:[\"ptnlessRecord\"],ptnlessRecord:function(){var sandbox=this._sandbox;var mod=this;var actions=[];var forms=sandbox.getElementsByTagName(\"form\");var hasSignupForm=false;var hasLoginForm=false;sandbox.Xnote(\"ptnlessRecord: forms.length = \"+forms.length);var _this=this;sandbox.forEach(forms,function(form,_,forms){var formType=sandbox.getFormType(form);switch(formType){case FORM_TYPE.LOGIN:hasLoginForm=true;case FORM_TYPE.PASSWORD_CHANGE:var action=sandbox.getFormAction(form);actions.push(action);sandbox.Xnote(\"ptnlessRecord: found the form: \"+action);_this.bindFormSubmit(form,formType);sandbox.forEach(form,function(input,_,form){var type=input.type;sandbox.Xnote(\"input.type = \"+type);if(!input.form||input.form!==form||type===\"hidden\"){return}if(type===\"password\"){sandbox.bindEncryptionEvents(input)}if(type===\"submit\"||type===\"button\"||type===\"image\"){sandbox.bindEventListener(input,\"click\",function(e){sandbox.Xnote(\"ptnlessRecord: trigger by click submit input button\");sandbox._isDataStored=false;mod.storeFormData(form,formType)})}var val=input.value;if(val==null||val==\"\"){sandbox.setInputDataProvidedStatus(input,\"no\")}else{sandbox.setInputDataProvidedStatus(input,\"yes\")}sandbox.bindEventListener(input,\"keydown\",function(e){if(e.keyCode!=13)return;sandbox.Xnote(\"ptnlessRecord: keydown 13 captured\");sandbox._isDataStored=false;mod.storeFormData(form,formType)});sandbox.bindEventListener(input,\"paste\",function(e){if(sandbox.validInputData(e.target,false)){sandbox.setInputDataProvidedStatus(e.target,\"yes\")}else{sandbox.setInputDataProvidedStatus(e.target,\"no\")}});sandbox.bindEventListener(input,\"input\",function(e){if(sandbox.validInputData(e.target,false)){sandbox.setInputDataProvidedStatus(e.target,\"yes\")}else{sandbox.setInputDataProvidedStatus(e.target,\"no\")}})});break;default:break}});sandbox.Xnote(\"ptnlessRecord: action.length = \"+actions.length);var res={};res.formAction=actions;res.location=sandbox.getLocation();if(res.location.indexOf(\"https://accounts.google.com/ServiceLogin\")==0&&res.location.indexOf(\"service=lso\")!=-1){res.location=\"https://accounts.google.com/ServiceLogin\"}else if(res.location.indexOf(\"https://www.facebook.com/login.php\")==0&&res.location.indexOf(\"fbconnect=1\")!=-1){res.location=\"https://www.facebook.com\"}else if(res.location.indexOf(\"https://login.yahoo.com/config/login\")==0&&res.location.indexOf(\".src=openid\")!=-1){res.location=\"https://login.yahoo.com/config/login\"}res.faviconURL=sandbox.getFaviconURL();res.domain=sandbox.getDomain();res.title=sandbox.getTitle();res.launchSW=false;res.showLaunchSW=false;res.recording=actions.length>0;res.readyToRecord=res.recording;res.hasSignupForm=hasSignupForm;res.hasLoginForm=hasLoginForm;res.dualModeRecord=false;if(!mod.isTopWindow()){sandbox.Xnote(\"ptnlessRecord: not top window!\");sandbox.Xnote(\"action.length = \"+actions.length);if(actions.length==0){sandbox.Xnote(\"ptnlessRecord: Don't return this frame!\");res.notReturn=true}}if(res.title==\"\"){res.title=res.domain}return res},isTopWindow:function(){return window==window.top},bindFormSubmit:function(form,formType){var sandbox=this._sandbox;var mod=this;formType=formType||FORM_TYPE.LOGIN;sandbox.bindEventListener(form,\"submit\",function(e){mod.storeFormData(e.target,formType)});sandbox.hookFormSubmit(form,function(){mod.storeFormData(form,formType)})},storeFormData:function(form,formType){var data;var domain=sandbox.getDomain();var location=sandbox.getLocation();var action=sandbox.getFormAction(form);formType=formType||FORM_TYPE.LOGIN;sandbox.Xnote(\"storeFormData: domain: \"+domain);if(formType===FORM_TYPE.LOGIN){data=sandbox.serializeForm(form)}else if(formType===FORM_TYPE.FORM_FILLING){data=sandbox.serializeSignupForm(form)}else if(formType===FORM_TYPE.PASSWORD_CHANGE){data=sandbox.serializePasswordForm(form)}if(!data){sandbox.Xnote(\"*** storeFormData: found input field(s) is empty. No 'storeData' event fired.\");return}var dataResult=sandbox.isDataProvided(data);var res={};res.domain=domain;res.formAction=action;res.siteID=0;res.data=data;res.location=location;res.formType=formType;res.saveOnSubmit=true;res.dataReadyFlag=dataResult.dataProvided;res.hasValue=dataResult.hasValue;if(formType===FORM_TYPE.FORM_FILLING){var signupPattern=sandbox.signupPattern;sandbox.Xnote(\"storeFormData: signupPattern = \"+sandbox.stringify(signupPattern));if(signupPattern!=null){res=sandbox.mapSignupStoreData(res);res.formAction=sandbox.normalizeFormAction(signupPattern.loginForm.formAction)}}sandbox.callback(\"storeData\",sandbox.stringify(res))}};meta.loadModule(sandbox,modPtnlessRecord);var modPtnlessReplay={_name:\"ptnless-replay\",_require:[\"callback\",\"dom\",\"log\",\"heuristics\",\"utils\"],_export:[\"ptnlessReplay\"],extractValidInputs:function(form){var sandbox=this._sandbox;var inputs=[];var input;var i;for(i=0;i<form.length;i++){input=form[i];if(sandbox.validInput(input)){inputs.push(input)}}return inputs},ptnlessReplay:function(passcard,fallback){var sandbox=this._sandbox;sandbox.Xnote(\"Enter [modPtnlessReplay][ptnlessReplay] Current location = \"+sandbox.getLocation());var domain=sandbox.getDomain();domain=domain.replace(/^(www\\.)+/i,\"\").toLowerCase();var domainWhiteList=passcard.domainWhiteList;var isInWhiteList=true;if(domainWhiteList!=null&&domainWhiteList.length>0){isInWhiteList=false;for(var index=0;index<domainWhiteList.length;index++){var domainInList=domainWhiteList[index].replace(/^(www\\.)+/i,\"\").toLowerCase();if(domain===domainInList){isInWhiteList=true;break}}}if(isInWhiteList===false){return}var fromItself=\"No fallback\";var fallbackFrom=fallback===undefined?fromItself:fallback.from||fromItself;var fallbackInfo=fallback===undefined?{}:fallback.extraInfo||{};sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Passcard.formAction = \"+passcard.formAction);var extraInfo={};if(fallbackInfo.siteID===undefined){sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Not invoked by pattern replay failure.\");extraInfo.siteID=0;extraInfo.currentStep=-1;extraInfo.pattern={};extraInfo.stepPattern={};extraInfo.locationNoQuery=sandbox.stripQueryString(sandbox.getLocation());extraInfo.passcardLocation=passcard.location;extraInfo.passcardInfo=sandbox.getPasscardAttr(passcard);extraInfo.referrer=sandbox._window.document.referrer;extraInfo.title=sandbox.getTitle()}else{sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Invoked by pattern replay failure.\");extraInfo.siteID=fallbackInfo.siteID;extraInfo.currentStep=fallbackInfo.currentStep||0;extraInfo.pattern=fallbackInfo.pattern||{};extraInfo.stepPattern=fallbackInfo.stepPattern||{};extraInfo.locationNoQuery=fallbackInfo.locationNoQuery;extraInfo.passcardLocation=passcard.location;extraInfo.passcardInfo=sandbox.getPasscardAttr(passcard);extraInfo.referrer=sandbox._window.document.referrer;extraInfo.title=fallbackInfo.title||sandbox.getTitle()}var form=null;var isFormDangerous=null;var validInputs=null;var forms=sandbox.getElementsByTagName(\"form\");for(var i=0;i<forms.length;++i){form=forms[i];if(sandbox.isLoginForm(form)&&sandbox.getFormAction(form).toLowerCase()===passcard.formAction.toLowerCase()){extraInfo.formAction=passcard.formAction;extraInfo.formData=sandbox.getLoginFormData(form);validInputs=this.extractValidInputs(form);if(sandbox.deserializeForm(validInputs,passcard.data)){sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] All fields filled in. passcard.submit = \"+passcard.submit);isFormDangerous=sandbox.isDangerousForm(form);if(isFormDangerous===true){sandbox.Xchkpt(\"[modPtnlessReplay][ptnlessReplay] In KIBANA Query extraInfo.replayOnDangerousForm:true\");extraInfo.replayOnDangerousForm=true}else{extraInfo.replayOnDangerousForm=false}if(fallbackFrom===\"pattern-platform-0\"){sandbox.engineFeedback(65824,\"[DUALMODE] ptn-0 replay NG->ptnless strict replay OK\",extraInfo)}else if(fallbackFrom===\"pattern-platform-1\"){sandbox.engineFeedback(65826,\"[DUALMODE] ptn-1 replay NG->ptnless strict replay OK\",extraInfo)}else if(fallbackFrom===\"pattern-platform-default\"){sandbox.engineFeedback(65828,\"[DUALMODE] ptn-default reached -> ptnless strict replay OK\",extraInfo)}else{sandbox.engineFeedback(65792,\"patternless strict replay OK\",extraInfo)}if(passcard.submit&&isFormDangerous===false){sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Submitting a form...\");sandbox.submitForm(form)}return}}}sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Try loosely match\");for(i=0;i<forms.length;++i){form=forms[i];if(sandbox.isLoginForm(form)){var action=sandbox.getFormAction(form);sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Potential login form: \"+action);extraInfo.formAction=action;extraInfo.formData=sandbox.getLoginFormData(form);validInputs=this.extractValidInputs(form);if(sandbox.deserializeForm(validInputs,passcard.data)){sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] All fields filled in. passcard.submit = \"+passcard.submit);isFormDangerous=sandbox.isDangerousForm(form);if(isFormDangerous===true){sandbox.Xchkpt(\"[modPtnlessReplay][ptnlessReplay] In KIBANA Query extraInfo.replayOnDangerousForm:true\");extraInfo.replayOnDangerousForm=true}else{extraInfo.replayOnDangerousForm=false}sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] FallbackFrom = \"+fallbackFrom);if(fallbackFrom===\"pattern-platform-0\"){sandbox.engineFeedback(65825,\"[DUALMODE] ptn-0 replay NG->ptnless loose replay OK\",extraInfo)}else if(fallbackFrom===\"pattern-platform-1\"){sandbox.engineFeedback(65827,\"[DUALMODE] ptn-1 replay NG->ptnless loose replay OK\",extraInfo)}else if(fallbackFrom===\"pattern-platform-default\"){sandbox.engineFeedback(65829,\"[DUALMODE] ptn-default reached -> ptnless loose replay OK\",extraInfo)}else{sandbox.engineFeedback(65793,\"patternless loose replay OK\",extraInfo)}if(passcard.submit&&isFormDangerous===false){sandbox.Xnote(\"[modPtnlessReplay][ptnlessReplay] Submitting a form...\");sandbox.submitForm(form)}return}}}if(fallbackFrom===\"pattern-platform-0\"){sandbox.engineFeedback(268501280,\"[DUALMODE] ptn-0 replay NG->ptnless replay NG\",extraInfo)}else if(fallbackFrom===\"pattern-platform-1\"){sandbox.engineFeedback(268501281,\"[DUALMODE] ptn-1 replay NG->ptnless replay NG\",extraInfo)}else if(fallbackFrom===\"pattern-default\"){sandbox.engineFeedback(268501282,\"[DUALMODE] ptn-default reached -> ptnless replay NG\",extraInfo)}else if(sandbox.getLoginFormIndex()>-1){sandbox.engineFeedback(268501248,\"ptnless replay NG\",extraInfo)}else{if(sandbox.getLoginFormIndex()===-1){sandbox.Xcept(\"[modPtnlessReplay][ptnlessReplay] Case [no visible login forms] gets into patternless failure feedback routine. Just log it, no feedback sent out.\")}else{sandbox.Xcept(\"[modPtnlessReplay][ptnlessReplay] Not handled cases get into patternless failure feedback routine. Just log it, no feedback sent out.\")}}return}};meta.loadModule(sandbox,modPtnlessReplay);var modDynamicForm={_name:\"dynamicForm\",_require:[\"event\",\"dom\",\"probe\"],_export:[\"probeAfterClick\",\"replayAfterAction\"],probeAfterClick:function(loginButtons,hasFormCreated,isIFrameFunc){if(isIFrameFunc==null||typeof isIFrameFunc!==\"function\"){isIFrameFunc=function(){return true}}var sandbox=this._sandbox;var tick=50;if(loginButtons==null){sandbox.Xnote(\"probeAfterClick: can't find loginButtons\");return}for(var i=0;i<loginButtons.length;i++){var loginButton=loginButtons[i];sandbox.bindEventListener(loginButton,\"click\",function(){var intervalId=setInterval(function(){sandbox.Xnote(\"setInterval for pooling login form...\");if(hasFormCreated()){sandbox.reprobe(isIFrameFunc());sandbox.Xnote(\"clearInterval for pooling login form...\");clearInterval(intervalId)}},tick)})}},replayAfterAction:function(action,hasFormCreated,replay){var tick=50;action();var intervalId=setInterval(function(){if(hasFormCreated()){replay();clearInterval(intervalId)}},tick)}};meta.loadModule(sandbox,modDynamicForm);var modElementEventHandler={_name:\"elementEventHandler\",_require:[\"event\",\"dom\",\"probe\"],_export:[\"AwaitElementAdded\",\"AwaitElementReload\",\"AwaitElementChange\",\"AwaitElementRemove\"],AwaitElementAdded:function(targetXPath,triggerXPath){var sandbox=this._sandbox;var mod=this;sandbox.Xnote(\"AwaitElementAdded: init\");var target,trigger;if((target=mod.chkAndGetElem(targetXPath))==null||(trigger=mod.chkAndGetElem(triggerXPath))==null){sandbox.Xnote(\"AwaitElementAdded: init failed\");return false}if(sandbox._window.document.addEventListener){var iframeHandler=function(e){e.target.removeEventListener(\"load\",iframeHandler,false);sandbox.reprobe(true);sandbox.Xnote(\"modElementEventHandler: get iframe, reprobe\")};var handler=function(e){e.target.removeEventListener(\"DOMNodeInserted\",handler,false);var childList=target.childNodes;for(var i=0;i<childList.length;i++){if(childList[i].tagName==\"IFRAME\"){mod.addEventOnce(childList[i],\"load\",iframeHandler,\"new\");return true}}sandbox.reprobe(false);sandbox.Xnote(\"modElementEventHandler: get element, reprobe\");return true};mod.addEventOnce(target,\"DOMNodeInserted\",handler,\"new\")}else{var childIdxArray=[],childLen=0;childLen=target.children.length;for(var i=0;i<childLen;i++){childIdxArray[i]=target.children[i].sourceIndex}var mod=this;var prevEvent=trigger.onclick;trigger.onclick=function(){if(prevEvent!=null)prevEvent();trigger.onclick=prevEvent;if(childLen==0){mod.loopWait(function(){if(target.lastChild){mod.eventNodeProbe(target.lastChild.tagName);return true}else{return false}})}else{mod.loopWait(function(){for(var i=0;i<childLen;i++){if(childIdxArray[i]!=target.children[i].sourceIndex){mod.eventNodeProbe(target.children[i].tagName);return true}}return false})}}}},AwaitElementReload:function(targetXPath){var sandbox=this._sandbox;sandbox.Xnote(\"wait element reload\");if(targetXPath==null){sandbox.Xnote(\"AwaitElementReload: element Xpath not set\");return}var frame=sandbox.getElementByXPath(targetXPath);var mod=this;var prevEvent=null;if(frame){try{if(!prevEvent){prevEvent=frame.onload;frame.onload=function(){if(prevEvent!=null)prevEvent();frame.onload=prevEvent;console.log(\"frame reload\");sandbox.Xnote(\"AwaitElementReload: frameReload\");sandbox.reprobe(true)}}}catch(e){sandbox.Xnote(\"AwaitElementReload: unable to replace the original onload function, \"+e.message)}}else{sandbox.Xcept(\"AwaitElementReload: element not found\")}},AwaitElementChange:function(targetXPath){var sandbox=this._sandbox;var mod=this;sandbox.Xnote(\"wait element change\");if(targetXPath==null){sandbox.Xnote(\"AwaitElementChange: element not found\");return}var target=sandbox.getElementByXPath(targetXPath);if(target==null){sandbox.Xnote(\"AwaitElementChange: Element not found\")}var mod=this;if(sandbox._window.MutationObserver){var mutationCallback=function(myMutations,obs){if(obs){obs.disconnect()}sandbox.Xnote(\"AwaitElementChange: changed\");sandbox.reprobe(false)};var observer=new MutationObserver(mutationCallback);var mutationConfig={attributes:true,characterData:true};try{observer.observe(target,mutationConfig)}catch(error){sandbox.Xnote(error.message)}}else if(sandbox._window.document.addEventListener){var handler=function(){target.removeEventListener(\"DOMAttrModified\",handler,false);sandbox.Xnote(\"AwaitElementChange: changed\");sandbox.reprobe(false)};mod.addEventOnce(target,\"DOMAttrModified\",handler,\"new\")}else{var handler=function(){target.detachEvent(\"onpropertychange\",handler);sandbox.Xnote(\"AwaitElementChange: changed\");sandbox.reprobe(false)};mod.addEventOnce(target,\"onpropertypchange\",handler,\"ie\")}},AwaitElementRemove:function(targetXPath){var sandbox=this._sandbox;var mod=this;sandbox.Xnote(\"AwaitElementRemove: init\");var target;if((target=mod.chkAndGetElem(targetXPath))==null){sandbox.Xnote(\"AwaitElementRemove: init failed\");return false}var lock=false;var childList=target.childNodes;if(sandbox._window.document.addEventListener){sandbox.Xnote(\"child number \"+childList.length);var handler=function(e){e.target.removeEventListener(\"DOMNodeRemoved\",handler,false);if(lock==false){lock=true;setTimeout(function(){sandbox.reprobe(false);lock=false},0)}else{sandbox.Xnote(\"AwaitElementRemove: is doing reprobe , skip this time\")}sandbox.Xnote(\"AwaitElementRemove: element removed\")};for(var i=0;i<childList.length;i++){if(childList[i].nodeType==1){sandbox.Xnote(\"bind \"+i);mod.addEventOnce(childList[i],\"DOMNodeRemoved\",handler,\"new\")}}}else{var childLen=childList.length;var idxArray=[];for(var i=0;i<childLen;i++){idxArray[i]=childList[i].sourceIndex}this.loopWait(function(){for(var i=0;i<childLen;i++){if(idxArray[i]!=target.childNodes[i].sourceIndex){sandbox.reprobe(false);sandbox.Xnote(\"AwaitElementRemove: element removed\");return true}}return false})}},loopWait:function(hasCreated){var sandbox=this._sandbox;var tick=50;var intervalId=setInterval(function(){sandbox.Xnote(\"setInterval for pooling login form...\");if(hasCreated()){clearInterval(intervalId);sandbox.Xnote(\"clearInterval for pooling login form...\")}},tick)},eventNodeProbe:function(nodeType){if(nodeType==\"IFRAME\"){sandbox.reprobe(true);sandbox.Xnote(\"modElementEventHandler: get iframe, reprobe\")}else{sandbox.reprobe(false);sandbox.Xnote(\"modElementEventHandler: get element, reprobe\")}},chkAndGetElem:function(xPath){var sandbox=this._sandbox;if(xPath===null||xPath==\"\"){sandbox.Xnote(\"chkAndGetElem: xPath not set\");return null}return sandbox.getElementByXPath(xPath)},addEventOnce:function(elem,event,handler,type){if(elem.PwmEventFlag==null){sandbox.Xnote(\"bind event once\");if(type==\"new\"){elem.addEventListener(event,handler,false)}else if(type==\"ie\"){elem.attachEvent(event,handler,false)}elem.PwmEventFlag=true}}};meta.loadModule(sandbox,modElementEventHandler);var modProbe={_name:\"probe\",_require:[\"callback\",\"browser\",\"dom\",\"ptnless-record\",\"pattern-platform\",\"heuristics\",\"utils\"],_export:[\"probe\",\"reprobe\"],probe:function(){if(!this.isSanity())return;var sandbox=this._sandbox;sandbox._isDataStored=false;var patternRecord=sandbox.patternRecord();var isPatternSite=patternRecord.siteID>0;var isMultiStepPtn=false;if(patternRecord.isMultiStepPattern!=null)isMultiStepPtn=patternRecord.isMultiStepPattern;var ptnlessRecord={};if(isPatternSite){if(patternRecord.readyToRecord==false&&isMultiStepPtn==false){sandbox.Xnote(\"[modProbe][probe] pattern#: \"+patternRecord.siteID+\", !readyToRecord && !isMultiStepPtn ==> perform ptnlessRecord({bind: true}\");ptnlessRecord=sandbox.ptnlessRecord();if(ptnlessRecord!=null){ptnlessRecord.dualModeRecord=true}}}else{ptnlessRecord=sandbox.ptnlessRecord()}var res={};res.formAction=ptnlessRecord.formAction;res.siteID=patternRecord.siteID;res.step=patternRecord.step;res.recording=ptnlessRecord.recording||patternRecord.recording;res.readyToRecord=ptnlessRecord.readyToRecord||patternRecord.readyToRecord;res.isMultiStepPattern=isMultiStepPtn;res.dualModeRecord=ptnlessRecord.dualModeRecord;res.guessLast=false;res.guessLoginFailed=false;var loc=isPatternSite?patternRecord.location:ptnlessRecord.location;if(loc==\"\"){loc=sandbox.getLocation()}res.location=sandbox.stripQueryString(loc);res.locationQuery=sandbox.getQueryString(loc);res.recordLoc=document.location.href;res.feedbackUrl=sandbox.stripQueryString(document.location.href)+\" @referrer[\"+sandbox._window.document.referrer.replace(\"?\",\"@delete@\")+\"]\";\nres.sbURL=isPatternSite?patternRecord.sbURL:document.location.href;res.domain=res.recording?isPatternSite?patternRecord.domain:ptnlessRecord.domain:\"\";if(res.domain==\"\"){res.domain=sandbox.getDomain()}res.faviconURL=res.recording?isPatternSite?patternRecord.faviconURL:ptnlessRecord.faviconURL:\"\";if(res.faviconURL==\"\"){res.faviconURL=sandbox.getFaviconURL()}res.title=res.recording?isPatternSite?patternRecord.title:ptnlessRecord.title:\"\";if(res.title==\"\"){res.title=sandbox.getTitle()}res.launchSW=isPatternSite?patternRecord.launchSW:ptnlessRecord.launchSW;res.showLaunchSW=isPatternSite?patternRecord.showLaunchSW:ptnlessRecord.showLaunchSW;res.notReturn=isPatternSite?patternRecord.notReturn:ptnlessRecord.notReturn;res.hasSignupForm=isPatternSite?patternRecord.hasSignupForm:ptnlessRecord.hasSignupForm;res.hasLoginForm=ptnlessRecord.hasLoginForm||false;var inputs=sandbox.getElementsByTagName(\"input\");var password=0;var text=0;for(var i=0;i<inputs.length;++i){var type=inputs[i].type;if(type==\"password\")++password;else++text}if(text>0&&password>0)res.isloginform=true;else res.isloginform=false;if(res.step!=999&&res.notReturn!==true){sandbox._probeResult=res;if(res.recording==false){sandbox.Xnote(\"bind for second chance\");sandbox.probeElemList=sandbox.probeElemList||[];var reprobeOnInputKeyInCallback=function(e){if(e.target==null||e.target.nodeName==null||e.target.nodeName!=\"INPUT\"||e.target.getAttribute(\"type\")==null){return}sandbox.Xnote(\"focus happened, on \"+e.target.nodeName);var type=e.target.getAttribute(\"type\").toLowerCase();if((type==\"text\"||type==\"password\"||type==\"email\"||type==\"tel\")&&sandbox.probeElemList.indexOf(e.target)==-1){sandbox.probeElemList.push(e.target);sandbox._window.removeEventListener(\"click\",reprobeOnInputKeyInCallback,true);sandbox.reprobe(false)}};sandbox._window.addEventListener(\"click\",reprobeOnInputKeyInCallback,true)}sandbox.callback(\"probeReturn\",sandbox.stringify(res));var resForLog={domain:res.domain,formAction:res.formAction,guessLast:res.guessLast,guessLoginFailed:res.guessLoginFailed,hasLoginForm:res.hasLoginForm,hasSignupForm:res.hasSignupForm,isloginform:res.isloginform,launchSW:res.launchSW,location:res.location,notReturn:res.notReturn,readyToRecord:res.readyToRecord,recordLoc:sandbox.stripQueryString(res.recordLoc),recording:res.recording,sbURL:sandbox.stripQueryString(res.sbURL),showLaunchSW:res.showLaunchSW,siteID:res.siteID,step:res.step,title:res.title};if(resForLog.formAction!=null){var formAction=resForLog.formAction;resForLog.formAction=[];for(var index=0;index<formAction.length;index++){resForLog.formAction[index]=sandbox.stripQueryString(formAction[index])}}sandbox.Xnote(\"probeReturn(resForLog): \"+sandbox.stringify(resForLog));if(sandbox.probeReturnHasDone){sandbox.probeReturnHasDone()}}else{sandbox.Xnote(\"ignore iframe probe return\")}var feedbackCallback=function(e){var targetForm=e.target;if(sandbox._window.document.addEventListener){sandbox.Xnote(\"probe() : addEventListener - feedbackCallback(): remove itself\");targetForm.removeEventListener(\"submit\",feedbackCallback)}else if(sandbox._window.document.attachEvent){sandbox.Xnote(\"probe() : detachEvent - feedbackCallback(): remove itself\");targetForm.detachEvent(\"submit\",feedbackCallback)}sandbox.Xnote(\"probe() : feedbackCallback() is to callback 'errorReturn' but check visible password field first.\");for(var i=0;i<targetForm.length;++i){if(targetForm[i].type==\"password\"&&sandbox.isVisible(targetForm[i])===true){sandbox.callback(\"errorReturn\",sandbox.stringify(res));sandbox.Xnote(\"probe() : feedbackCallback() callback 'errorReturn'\");break}}};sandbox.Xnote(\"probe() - Search potential login forms and bind 'errorReturn' event for failure feedback if it's submitted w/o 'stroeData' received.\");var forms=sandbox.getElementsByTagName(\"form\");sandbox.Xnote(\"probe() - total forms = \"+forms.length);for(var i=0;i<forms.length;++i){var passwordFlag=false;for(var j=0;j<forms[i].length;++j){if(forms[i][j].type==\"password\"&&sandbox.isVisible(forms[i][j])===true){passwordFlag=true;sandbox.Xnote(\"probe() - Found a form w/ visible password field...passwordFlag = true\");break}}if(passwordFlag===false){sandbox.Xnote(\"feedback: guess is search bar , skip\");continue}sandbox.bindEventListener(forms[i],\"submit\",feedbackCallback);sandbox.Xnote(\"probe() - Bound feedbackCallback('errorrReturn') on form # \"+i)}},reprobe:function(probeIFrames){if(!this.isSanity())return;var sandbox=this._sandbox;sandbox._isDataStored=false;if(probeIFrames==null){probeIFrames=true}if(probeIFrames){sandbox.callback(\"reprobe\")}else{this.probe()}},isSanity:function(){var sandbox=this._sandbox;if(!sandbox.isSanity()){sandbox.callback(\"sandboxNotClean\");return true}return true}};meta.loadModule(sandbox,modProbe);var modReplay={_name:\"replay\",_require:[\"callback\",\"browser\",\"ptnless-replay\",\"pattern-platform\",\"log\"],_export:[\"replay\"],replay:function(passcard){if(!this.isSanity())return;var sandbox=this._sandbox;if(passcard.data==null){sandbox.Xcept(\"[modReplay][replay] passcard.data not found\");return}if(passcard.submit==null){sandbox.Xcept(\"[modReplay][replay] passcard.submit not defined, set to false\");passcard.submit=false}var pattern=sandbox._pattern;if(passcard.siteID>0){sandbox.Xnote(\"[modReplay][replay] passcard.siteID > 0, go pattern replay\");sandbox.patternReplay(passcard)}else if(pattern!=null&&pattern.siteID>0){sandbox.Xnote(\"[modReplay][replay] passcard.siteID==0, but this is a pattern site (#\"+pattern.siteID+\"), go pattern replay\");sandbox.patternReplay(passcard)}else{sandbox.Xnote(\"[modReplay][replay] No site ID found, go patternless replay\");sandbox.ptnlessReplay(passcard)}},isSanity:function(){var sandbox=this._sandbox;if(!sandbox.isSanity()){sandbox.callback(\"sandboxNotClean\");return true}return true}};meta.loadModule(sandbox,modReplay);var modSignup={_name:\"signup\",_export:[\"mapSignupStoreData\"],mapSignupStoreData:function(res){var signupPattern=sandbox.signupPattern;sandbox.Xnote(\"mapSignupStoreData: signupPattern = \"+JSON.stringify(signupPattern));if(signupPattern!=null){if(res.data!=null){for(var i=0;i<res.data.length;i++){if(res.data[i].account===true){res.data[i].name=signupPattern.loginForm.account}else if(res.data[i].name===signupPattern.signupForm.password){res.data[i].name=signupPattern.loginForm.password}}}res.loginFormLocation=signupPattern.loginForm.location}return res}};meta.loadModule(sandbox,modSignup);var modFormFilling={_name:\"formFilling\",_require:[\"event\",\"utils\",\"dom\",\"heuristics\",\"browser\"],_export:[\"startFormFilling\",\"autoFill\",\"detect\",\"setStyltPath\",\"injectStyles\"],tmpTargetElement:[],map_userInfoFlag:[],map_isDeletable:[],map_webElementArray:[],map_dataItemIdArray:[],map_dataItemAliasArray:[],map_isFilled:[],map_defaultValue:[],autoLearnExceptionKeys:[\"personal_title\",\"personal_gender\",\"address_country\",\"creditcard_type\"],isMouseOnBlock:false,defaultFormTitle:\"ui_default_form\",popoutblockColor:{normal:\"#FFFFFF\",mouseover:\"#FAFAFA\"},creditCardKeyword:\"creditcard_\",cachedPopoutBlock:null,formFillingBoxCss:\"\",injectedCSSRules:\".tmid_modified { background: #E4F1FD !important; border: 1px solid #3385D6 !important; } \"+\".tmid_modifying { background: #E4F1FD !important; } \"+\"#popoutblock.tmid_show { visibility: visible !important; } \"+\"#popoutblock.tmid_hide { visibility: hidden !important; } \"+\"#popoutblock.tmid_popoutblock { display: table; position: absolute; top: 1px; left: 1px; visibility: hidden; width: 120px; height: 40px; background-color: #FFFFFF; z-index: 9999; color: #666666; font-size: 16px; box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.25); text-shadow: 1px 0px 0px rgba(170, 170, 170, 1); }\"+\"#popoutblock .tmid_formFillHint { display: table-cell; vertical-align: middle; font-size: 16px; visibility: inherit !important; }\"+\"#popoutblock .tmid_icon { width: 24px; height: 24px; visibility: inherit !important; }\"+\"#popoutblock .tmid_popoutblockicon { display: table-cell; vertical-align: middle; width: 24px; height: 24px; padding: 8px 8px 8px 8px; visibility: inherit !important; }\",unlockedImgData:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozODk2QjYwNDBGMjA2ODExODIyQTg2RjdGNDdBRjZBMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMTZDODU1MUQxQTcxMUUzQkEyNEZBQjhBRUIwODkyNCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMTZDODU1MEQxQTcxMUUzQkEyNEZBQjhBRUIwODkyNCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MDM4MDExNzQwNzIwNjgxMTgwODNGQUNFNTZDMTE3MjgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Mzg5NkI2MDQwRjIwNjgxMTgyMkE4NkY3RjQ3QUY2QTMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7DohV5AAAC40lEQVR42sSXS0iVURDHu2ZFGmbkJrwllURSIEGLoge9jaywIiixTW16QYvAFhWKlFCQSIuKFrWI0MAgwkWgUJeiKEIkpLIn3EohsdDIwEf2H5gPhmHO99AvHPhx7z3f3DNzZuacM1+iN1k4aSIlI4LuElANHoEeMb4PpEEzqAQLoziQCBGBFaAWrNf/5c9ycFuMj4JWUAOejCcC08EV8NQwPuL47jm2GTwGt8CssTiQB1LgiFgprewBKAOzhe4dMB8cB+/VPBXgJVgaJQUz2XixGPsKDoKWgIhmglOgCkwR471gE2gP40AT2CN+v+OQpiPUVhlHZqpaBNXTN78UVCjjfWCbYXwBG3jNeU6q5/fAMTWWZN0MVwTI249qspOgTk2UzYbnibG3nLJBpUu7YJUaOwRuWBEoV8Ypb9eM8G5UxkkWg5WGbq0xViNTIx04oBTvgwFjgmFH3q3xFk6jlHyZZs+BLLBaKT53GKJD5pMao+p+ZugOgTZjfL92oFhVLEmXwwHK81rwk3+TM1vAX4e+Nc8Gb5t6Dsw1lGb4bDPaSr+EgR4f3WnGGBVykXQgx1DKj+nCc81TKB34YyisicE4RXG541mOd3SSfDcUtoI5oNsxwWWwiM96l+xWR7J5dpN0GM+oKM+Co47/XgpYPeX+tM/zfpkCWmWnoXQY7Bhj+C9whFzyQR9ETdZtCRpBSUTj58AJn+e/wRvtwHU+OLRkcbtVzdsnqOKbA0JP8tCzJR2gG++qT63QHf8F1IOdYLKo5l3gJjckpSEi1OjqB6gZeWVcNpbk8jlfyqsOK13cQQ1a/QBNuNdxCcUlVfLatnrCF9yE9P0H4ylOVWBTSorrwOcYjXdzxzUSti1v5272ok8PEFZ+gO3cF0Z6MxrgLrcAnDHa7jCS5veKtvG8mlHlnueTrYBrJEyhNoBlvLN874KoKwpq0Vv5NEwFTZYZQ3GNcm472ODdKKlKTPTr+T8BBgA9QZjuELQ8SAAAAABJRU5ErkJggg==\",getFormFillHintElement:function(){return document.getElementById(\"tmid_formFillHint\")},getPopoutBlockElement:function(){return document.getElementById(\"popoutblock\")},showLockedIcon:function(isLocked){var iconImg=document.getElementById(\"tmid_icon\");if(isLocked){iconImg.src=this.unlockedImgData}else{iconImg.src=this.unlockedImgData}},isPopoutBlockExisted:function(){return this.getPopoutBlockElement()!=null},eraseCachedObject:function(cachedObject){cachedObject=null;delete cachedObject},composeWriteJsonString:function(title,userInfo){var formData={};formData.FormTitle=title;formData.UserInfo=userInfo;return this._sandbox.stringify(formData)},composeReadJsonString:function(title,isPreview){var formData={};formData.FormTitle=title;formData.IsPreview=isPreview;return this._sandbox.stringify(formData)},composeCallBackJsonString:function(title,dataObj){dataObj.FormTitle=title;return this._sandbox.stringify(dataObj)},autoFill:function(dataJsonObject){var userInfoObject=dataJsonObject.UserInfo;var isPreview=dataJsonObject.IsPreview;var pinState=dataJsonObject.PinState;var userInfoFlag=dataJsonObject.UserInfoFlag;var confirmFormfilling=dataJsonObject.ConfirmFormfilling?dataJsonObject.ConfirmFormfilling:-1;var i=0;var sandbox=this._sandbox;if(pinState===0&&userInfoObject===-1&&(isPreview===0||isPreview===-1)){meta.log(\"Please edit a auto form filling profile\");return}if(isPreview==3){for(i=0;i<this.map_dataItemIdArray.length;i++){var flag=userInfoFlag[this.map_dataItemIdArray[i]];this.map_userInfoFlag[i]=flag}var dataObj={};dataObj.OperationCode=1;var isFillable=false;for(i=0;i<this.map_userInfoFlag.length;i++){if(this.map_userInfoFlag[i]==\"1\")isFillable=true}dataObj.IsFillable=isFillable;sandbox.callback(\"formFillingCallback\",this.composeCallBackJsonString(this.defaultFormTitle,dataObj));return}if(isPreview==1){if(pinState==-1){if(!this.isPopoutBlockExisted()){this.createPopoutBlock()}this.showLockedIcon(true);this.displayPopout();return}var targetElement=this.tmpTargetElement[0];var targetElementId=targetElement.id?targetElement.id:targetElement.name;meta.log(\"targetElement:  \"+targetElementId);var key;for(i=0;i<this.map_webElementArray.length;i++){var webElementId=this.map_webElementArray[i].id?this.map_webElementArray[i].id:this.map_webElementArray[i].name;if(targetElementId==webElementId){key=this.map_dataItemIdArray[i]}}if(userInfoObject[key]==null||userInfoObject[key]===\"\"||userInfoObject[key]===\"-1\"||userInfoObject[key]===\"0\"){this.hidePopout()}else{if(!this.isPopoutBlockExisted()){this.createPopoutBlock()}this.showLockedIcon(false);this.displayPopout()}return}if(dataJsonObject.PinState==-1)return;if(isPreview==-1){this.removeAll();for(i=0;i<this.map_webElementArray.length;i++){var element=this.map_webElementArray[i];if(element.value==this.map_defaultValue[i]){var formfillingValue=userInfoObject[this.map_dataItemIdArray[i]];if(formfillingValue==null||formfillingValue===\"\"||formfillingValue===\"-1\"||formfillingValue===\"0\"){this.map_isDeletable[i]=-1}else{if(element.type==\"select-one\"||element.type==\"select-multiple\"){var selectOptions=element.options;var isMatched=0;for(var k=0;k<selectOptions.length;k++){if(selectOptions[k].value==formfillingValue){isMatched=1;break}}if(isMatched===0){this.map_isDeletable[i]=-1;continue}}var delimiter=formfillingValue.indexOf(\"-\");if(this.map_dataItemIdArray[i].match(\"address_zip\")&&delimiter!=-1){if(element.name.match(\"1\")){formfillingValue=formfillingValue.substring(0,delimiter)}else if(element.name.match(\"2\")){formfillingValue=formfillingValue.substring(delimiter+1)}}if(this.map_dataItemIdArray[i].match(\"phone\")&&delimiter!=-1){var telData=formfillingValue.split(\"-\");for(var c=1;c<=telData.length;c++){if(element.name.match(c)){formfillingValue=telData[c-1]}}}if(element.type==\"text\"){if(element.maxLength!=-1&&element.maxLength<formfillingValue.length){this.map_isDeletable[i]=-1;continue}}if(document.location.protocol==\"http:\"&&confirmFormfilling!=1){for(var m=0;m<this.map_webElementArray.length;m++){if(this.map_dataItemIdArray[m].match(this.creditCardKeyword)!=null&&this.map_userInfoFlag[m]==\"1\"){var formTitle=this.defaultFormTitle;var isPreview=2;var jsonStr=this.composeReadJsonString(formTitle,isPreview);sandbox.callback(\"queryAndAutoFill\",jsonStr);return}}}this.removePlaceHolder();element.value=formfillingValue;this._sandbox.addClass(element,\"tmid_modified\");this.map_isDeletable[i]=-1;this.map_isFilled[i]=0}}}}else if(isPreview===0){if(this.isMouseOnBlock!==true)return;this.removeAll();for(var i=0;i<this.map_webElementArray.length;i++){var element=this.map_webElementArray[i];if(element.value==this.map_defaultValue[i]){var formfillingValue=userInfoObject[this.map_dataItemIdArray[i]];if(formfillingValue==null||formfillingValue===\"\"||formfillingValue===\"-1\"||formfillingValue===\"0\"){this.map_isDeletable[i]=0}else{if(element.type==\"select-one\"||element.type==\"select-multiple\"){var selectOptions=element.options;var isMatched=0;for(var k=0;k<selectOptions.length;k++){if(selectOptions[k].value==formfillingValue){isMatched=1;break}}if(isMatched===0){this.map_isDeletable[i]=0;continue}}var delimiter=formfillingValue.indexOf(\"-\");if(this.map_dataItemIdArray[i].match(\"address_zip\")&&delimiter!=-1){if(element.name.match(\"1\")){formfillingValue=formfillingValue.substring(0,delimiter)}else if(element.name.match(\"2\")){formfillingValue=formfillingValue.substring(delimiter+1)}}if(this.map_dataItemIdArray[i].match(\"phone\")&&delimiter!=-1){var telData=formfillingValue.split(\"-\");for(c=1;c<=telData.length;c++){if(element.name.match(c)){formfillingValue=telData[c-1]}}}if(element.type==\"text\"){if(element.maxLength!=-1&&element.maxLength<formfillingValue.length){this.map_isDeletable[i]=0;continue}}this.removePlaceHolder();element.value=formfillingValue;this._sandbox.addClass(element,\"tmid_modifying\");this.map_isDeletable[i]=0}}}}this.isCallBackComplete=true;this.eraseCachedObject(userInfoObject);this.eraseCachedObject(dataJsonObject)},removeAll:function(){for(var i=0;i<this.map_webElementArray.length;i++){if(this.map_isDeletable[i]===0){var element=this.map_webElementArray[i];element.value=this.map_defaultValue[i];this._sandbox.removeClass(element,\"tmid_modified\");this._sandbox.removeClass(element,\"tmid_modifying\")}}},initIsDeletableArray:function(){for(var i=0;i<this.map_webElementArray.length;i++){var element=this.map_webElementArray[i];if(element.value==this.map_defaultValue[i]){this.map_isDeletable[i]=0}else if(element.value===\"\"){this.map_isDeletable[i]=0}else{this.map_isDeletable[i]=-1}if(this.map_isFilled[i]==null){this.map_isFilled[i]=-1}}},createPopoutBlock:function(){if(this.cachedPopoutBlock!=null){return}var sandbox=this._sandbox;var d=document.createElement(\"div\");d.id=\"popoutblock\";sandbox.addClass(d,\"tmid_popoutblock\");sandbox.addClass(d,\"tmid_hide\");var iconDiv=document.createElement(\"div\");sandbox.addClass(iconDiv,\"tmid_popoutblockicon\");iconDiv.id=\"tmid_popoutblockicon\";var img=document.createElement(\"img\");img.id=\"tmid_icon\";sandbox.addClass(img,\"tmid_icon\");img.src=this.unlockedImgData;iconDiv.appendChild(img);d.appendChild(iconDiv);var textDiv=document.createElement(\"div\");textDiv.id=\"tmid_formFillHint\";sandbox.addClass(textDiv,\"tmid_formFillHint\");textDiv.innerHTML=l10n.formFill_hint;d.appendChild(textDiv);this.cachedPopoutBlock=d;var mod=this;sandbox.bindEventListener(textDiv,\"mouseover\",function(e){mod.initIsDeletableArray();mod.isMouseOnBlock=true;d.style.backgroundColor=mod.popoutblockColor.mouseover;textDiv.style.cursor=\"pointer\";var formTitle=mod.defaultFormTitle;var isPreview=0;var jsonStr=mod.composeReadJsonString(formTitle,isPreview);sandbox.callback(\"queryAndAutoFill\",jsonStr)});sandbox.bindEventListener(textDiv,\"mouseout\",function(e){mod.isMouseOnBlock=false;d.style.backgroundColor=mod.popoutblockColor.normal;textDiv.style.cursor=\"default\";mod.removeAll()});function onTextDivClick(e){var formTitle=mod.defaultFormTitle;var isPreview=-1;var jsonStr=mod.composeReadJsonString(formTitle,isPreview);sandbox.callback(\"queryAndAutoFill\",jsonStr);mod.hidePopout()}function onIconDivMouseDown(e){for(var i=0;i<mod.map_webElementArray.length;i++){var element=mod.map_webElementArray[i];if(mod.map_isFilled[i]===0){if(element.tagName===\"SELECT\"){element.value=\"-1\";element.style.backgroundColor=mod.popoutblockColor.normal}else{element.value=\"\";element.style.backgroundColor=mod.popoutblockColor.normal}mod.map_isDeletable[i]=0;mod.map_isFilled[i]=-1}}}sandbox.bindEventListener(textDiv,\"click\",onTextDivClick);sandbox.bindEventListener(iconDiv,\"mousedown\",onIconDivMouseDown);sandbox.bindEventListener(textDiv,\"touchend\",onTextDivClick);sandbox.bindEventListener(iconDiv,\"touchstart\",onIconDivMouseDown);document.body.appendChild(d);return d},replaceAll:function(strOrg,strFind,strReplace){var index=0;while(strOrg.indexOf(strFind,index)!=-1){strOrg=strOrg.replace(strFind,strReplace);index=strOrg.indexOf(strFind,index)}return strOrg},match:function(textId,dataItemId){textId=this.replaceAll(textId,\"_\",\"\");textId=this.replaceAll(textId,\"-\",\"\");textId=this.replaceAll(textId,\".\",\"\");dataItemId=this.replaceAll(dataItemId,\"_\",\"\");dataItemId=this.replaceAll(dataItemId,\"-\",\"\");dataItemId=this.replaceAll(dataItemId,\".\",\"\");var regExp=new RegExp(dataItemId,\"i\");if(regExp.test(textId)){return true}else{return false}},getElementsByDataItemId:function(dataItemId){var sandbox=this._sandbox;var elementsArray=[];var inputElements=sandbox.getElementsByTagName(\"input\");var element=null;var elementId;for(var k=0;k<inputElements.length;k++){var element=inputElements[k];if(element.type==\"hidden\")continue;if(element.type==\"text\"||element.type==\"password\"||element.type==\"radio\"||element.type==\"email\"||element.type==\"number\"){if(element.id===\"\"&&element.name===\"\")continue;if(element.name!==\"\"){elementId=element.name;if(this.match(elementId,dataItemId)){elementsArray.push(element);continue}}elementId=element.id;if(this.match(elementId,dataItemId)){elementsArray.push(element)}}}var selectElements=document.getElementsByTagName(\"select\");for(var m=0;m<selectElements.length;m++){element=selectElements[m];if(element.id===\"\"&&element.name===\"\")continue;if(element.name!==\"\"){elementId=element.name;if(this.match(elementId,dataItemId)){elementsArray.push(element);continue}}elementId=element.id;if(this.match(elementId,dataItemId)){elementsArray.push(element)}}return elementsArray},toDefaultColor:function(e){var targetElement;if(!e)var e=window.event;if(e.target)targetElement=e.target;else if(e.srcElement)targetElement=e.srcElement;if(targetElement.nodeType==3)targetElement=targetElement.parentNode;this._sandbox.removeClass(targetElement,\"tmid_modified\");this._sandbox.removeClass(targetElement,\"tmid_modifying\")},showPopoutBlock:function(e){var sandbox=this._sandbox;var targetElement;if(!e)var e=window.event;if(e.target)targetElement=e.target;else if(e.srcElement)targetElement=e.srcElement;if(targetElement.nodeType==3)targetElement=targetElement.parentNode;if(targetElement.value!==\"\")return;for(var i=0;i<this.map_webElementArray.length;i++){if(sandbox.compareElements(targetElement,this.map_webElementArray[i]))if(this.map_userInfoFlag[i]===\"0\")return}if(!this.isPopoutBlockExisted()){this.createPopoutBlock()}targetElement.parentNode.appendChild(this.cachedPopoutBlock);if(!targetElement.parentNode.style.position)targetElement.parentNode.style.position=\"relative\";this.cachedPopoutBlock.style.top=targetElement.offsetTop+targetElement.offsetHeight+1+\"px\";this.cachedPopoutBlock.style.left=targetElement.offsetLeft+\"px\";var textDiv=this.getFormFillHintElement();if(targetElement.offsetWidth>280){this.cachedPopoutBlock.style.width=targetElement.offsetWidth+\"px\";textDiv.style.width=targetElement.offsetWidth-(24+2*8)+\"px\"}else{this.cachedPopoutBlock.style.width=\"280px\";textDiv.style.width=280-(24+2*8)+\"px\"}this.tmpTargetElement[0]=targetElement;var formTitle=this.defaultFormTitle;var isPreview=1;var jsonStr=this.composeReadJsonString(formTitle,isPreview);sandbox.callback(\"queryAndAutoFill\",jsonStr)},initUserInfoFlag:function(){var sandbox=this._sandbox;for(var i=0;i<this.map_webElementArray.length;i++){this.map_userInfoFlag[i]=0}var isPreview=3;var jsonStr=this.composeReadJsonString(this.defaultFormTitle,isPreview);sandbox.callback(\"queryAndAutoFill\",jsonStr)},detect:function(objKeyAlias){var mod=this;var sandbox=this._sandbox;var keyAliasJsonObject=objKeyAlias.KeyAndAlias;var pinState=objKeyAlias.PinState;var dataItemId;var elementsArray;var aliasArray;var debugMode=false;for(var dataItemId in keyAliasJsonObject){aliasArray=keyAliasJsonObject[dataItemId];for(var j=0;j<aliasArray.length;j++){if(debugMode)window.console.log(\"detecting... \"+dataItemId+\" with alias: \"+aliasArray[j]);var dataItemIdAlias=aliasArray[j];elementsArray=this.getElementsByDataItemId(dataItemIdAlias);if(elementsArray.length===0)continue;for(var i=0;i<elementsArray.length;i++){var indexOfElement=-1;for(var q=0;q<this.map_webElementArray.length;q++){if(this.map_webElementArray[q]==elementsArray[i]){indexOfElement=q;break}}if(indexOfElement!=-1){if(this.map_dataItemAliasArray[indexOfElement].length<dataItemIdAlias.length){this.map_dataItemIdArray[indexOfElement]=dataItemId;this.map_dataItemAliasArray[indexOfElement]=dataItemIdAlias;var elementName=!this.map_webElementArray[indexOfElement].name?this.map_webElementArray[indexOfElement].id:this.map_webElementArray[indexOfElement].name;if(debugMode){window.console.log(\"REPLACE-----------------------------------------\");window.console.log(elementName+\": \"+dataItemId+\": \"+dataItemIdAlias);window.console.log(\"END REPLACE-----------------------------------------\")}}continue}this.map_webElementArray.push(elementsArray[i]);this.map_dataItemIdArray.push(dataItemId);this.map_dataItemAliasArray.push(dataItemIdAlias);this.map_defaultValue[this.map_webElementArray.length-1]=elementsArray[i].value?elementsArray[i].value:\"\";var elementName=!elementsArray[i].name?elementsArray[i].id:elementsArray[i].name;if(debugMode){window.console.log(\"PUSH-----------------------------------------\");window.console.log(elementName+\": \"+dataItemId+\": \"+dataItemIdAlias);window.console.log(\"END PUSH-----------------------------------------\")}sandbox.bindEventListener(elementsArray[i],\"click\",function(e){mod.isMouseOnBlock=false;mod.showPopoutBlock(e)});sandbox.bindEventListener(elementsArray[i],\"keydown\",function(e){mod.toDefaultColor(e)});sandbox.bindEventListener(elementsArray[i],\"blur\",function(e){if(mod.isMouseOnBlock)return;mod.hidePopout()})}}}if(debugMode){window.console.log(\"Final-----------------------------------------\");for(var i=0;i<this.map_webElementArray.length;i++){var elementName=!this.map_webElementArray[i].name?this.map_webElementArray[i].id:this.map_webElementArray[i].name;window.console.log(elementName+\": \"+this.map_dataItemAliasArray[i])}}if(this.map_webElementArray.length>0){if(!this.isPopoutBlockExisted()){this.createPopoutBlock()}var forms=sandbox.getElementsByTagName(\"form\");for(var i=0;i<forms.length;i++){if(sandbox.isAutoLearnForm(forms[i]))this.bindFormSubmit(forms[i])}this.initUserInfoFlag()}},bindFormSubmit:function(form){var sandbox=this._sandbox;var mod=this;sandbox.bindEventListener(form,\"submit\",function(e){var form=e.target;var formFillingData={};formFillingData.FormTitle=mod.defaultFormTitle;formFillingData.AutoLearn=\"enable\";var userInfo={};for(var i=0;i<mod.map_webElementArray.length;i++){var key=mod.map_dataItemIdArray[i];var oldValue,newValue,finalValue;if(sandbox.inArray(key,mod.autoLearnExceptionKeys))continue;if(userInfo[key]==null){finalValue=mod.map_webElementArray[i].value}else{oldValue=userInfo[key];newValue=mod.map_webElementArray[i].value;finalValue=newValue.length>oldValue.length?newValue:oldValue}userInfo[key]=finalValue}formFillingData.UserInfo=userInfo;sandbox.callback(\"writeFormFillingData\",sandbox.stringify(formFillingData))})},startFormFilling:function(){var sandbox=this._sandbox;var mod=this;sandbox.bindEventListener(window,\"resize\",function(){mod.hidePopout()})},setStyltPath:function(path){this.formFillingBoxCss=path},injectStyles:function(done){var linkEle=document.createElement(\"link\");var hrefStr=this.formFillingBoxCss;linkEle.setAttribute(\"href\",hrefStr);linkEle.setAttribute(\"rel\",\"stylesheet\");if(typeof done===\"function\"){linkEle.onload=function(){done()}}document.head.appendChild(linkEle)},removePlaceHolder:function(){try{if(navigator.userAgent.match(/MSIE/)!=null)document.styleSheets[0].addRule(\".signuponepage .form-element .placeholder-text\",\"z-index: -1\");else document.styleSheets[0].insertRule(\".signuponepage .form-element .placeholder-text {z-index: -1}\",0)}catch(e){sandbox.Xnote(\"not google account page\")}},displayPopout:function(){if(this.cachedPopoutBlock!=null){sandbox.removeClass(this.cachedPopoutBlock,\"tmid_hide\");sandbox.addClass(this.cachedPopoutBlock,\"tmid_show\")}},hidePopout:function(){if(this.cachedPopoutBlock!=null){sandbox.removeClass(this.cachedPopoutBlock,\"tmid_show\");sandbox.addClass(this.cachedPopoutBlock,\"tmid_hide\")}}};meta.loadModule(sandbox,modFormFilling)})();","autofill":"(function(){var SANDBOX_KEY=\"-fj2odJ<#!>>m9*#JA)@\";var DP_VERSION=\"3.6\";var ENGINE_VERSION=undefined;var ENGINE_BUILD_NO=undefined;var DATA_READY_STATUS={};var FORM_TYPE={UNKNOWN:0,LOGIN:1,FORM_FILLING:2,PASSWORD_CHANGE:3};var meta={validateSandbox:function(root,sandboxId){if(root[sandboxId]===undefined)return false;if(root[sandboxId]._key!=SANDBOX_KEY)return false;return true},createSandbox:function(win,root,sandboxId){root[sandboxId]={_key:SANDBOX_KEY,_window:win,_callback:root._$PWMCallback};return root[sandboxId]},getSandbox:function(win,root,sandboxId){if(this.validateSandbox(root,sandboxId))return root[sandboxId];else return this.createSandbox(win,root,sandboxId)},log:function(msg){},loadModule:function(sandbox,mod){if(!sandbox._modules||typeof sandbox._modules!=\"object\")sandbox._modules={};var mods=sandbox._modules;if(!mod._name){this.log(\"Module name not found\");return}mods[mod._name]=mod;mod._sandbox=sandbox;if(mod._exportAll===true){for(var key in mod){if(typeof mod[key]!==\"function\"&&/_.+/.test(mod[key])===false){sandbox[key]=mod[key]}}}else if(mod._export&&mod._export.length){for(var i=0;i<mod._export.length;++i){var _export=mod._export[i];if(sandbox[_export])continue;if(typeof mod[_export]!==\"function\"){sandbox[_export]=mod[_export]}else{sandbox[_export]=function(m,f){return function(){return f.apply(m,arguments)}}(mod,mod[_export])}}}}};var sandbox=meta.getSandbox(window,root,\"_$tmidsafe\");try{sandbox.autoFill($autofilldata$)}catch(e){sandbox.Xcept(\"autofill exception: \"+e.message)}})();"}
